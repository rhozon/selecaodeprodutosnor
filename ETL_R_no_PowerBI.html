<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Rodrigo Hermont Ozon" />


<title>Fazendo um ETL com R no Power BI</title>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<script src="site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.19/datatables.js"></script>
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="site_libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="site_libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="site_libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="site_libs/selectize-0.12.0/selectize.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Tutoriais</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="https://rhozon.github.io/">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="https://rhozon.github.io/site/about.html">
    <span class="fa fa-info"></span>
     
    About
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Selecione
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">ENSINO</li>
    <li class="divider"></li>
    <li>
      <a href="index.html">Guia de Tutoriais</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="EscolhadeProdutoseAnaliseConjuntanoR.html">Mix de produtos com Analise Conjunta no R</a>
    </li>
    <li>
      <a href="ComparandoprecosAirbnb.html">Comparando precos de estadias no Airbnb com R</a>
    </li>
    <li>
      <a href="TesteABnoR.html">Teste AB para campanhas de marketing no R</a>
    </li>
    <li>
      <a href="RegressaodoComPrincipal.html">Regressão do Componente Principal no Excel para Multicolinearidade</a>
    </li>
    <li>
      <a href="Ridge.html">Regressão Ridge no Excel e no R para Multicolinearidade</a>
    </li>
    <li>
      <a href="Markov.html">Processos Estocásticos e Cadeias de Markov</a>
    </li>
    <li>
      <a href="ExercicioAnaliseFatorial.html">Análise de Componentes Principais e Fatorial</a>
    </li>
    <li>
      <a href="grafsuperficie.html">Gráfico 3D interativo para regressão múltipla</a>
    </li>
    <li>
      <a href="arvorededecisao.html">Árvores de Decisão para modelos de regressão</a>
    </li>
    <li>
      <a href="economiaderedes.html">Redes econômicas: Teoria de Redes na Economia usando R</a>
    </li>
    <li>
      <a href="cotacoes.html">Modelos da família ARCH em tempo real para dados de ações (VALE e PETRO)</a>
    </li>
    <li>
      <a href="inferenciacausal.html">Inferência Causal na Economia</a>
    </li>
    <li>
      <a href="varinstrumentais.html">Variáveis Instrumentais e Inferência Causal</a>
    </li>
    <li>
      <a href="rmarkdownepowerbi.html">Fluxo de Salarios Microdados CAGED</a>
    </li>
    <li>
      <a href="sparklyr.html">Big Data com o R: Lendo os microdados do CAGED com sparklyr</a>
    </li>
    <li>
      <a href="automsecex.html">Automação da visualização da base de dados da balança comercial brasileira</a>
    </li>
    <li>
      <a href="coinmarketcapxicoinomia.html">Webscrapping CoinMarketCap x Icoinomia</a>
    </li>
    <li>
      <a href="projetointegrador.html">Projeto Integrador de Ciência de Dados</a>
    </li>
    <li>
      <a href="homeworkI.html">Homework I: Econometrics (Shangai University of Finance)</a>
    </li>
    <li>
      <a href="problemset2.html">Homework II: Econometrics (Shangai University of Finance)</a>
    </li>
    <li>
      <a href="problemset2.html">Homework II: Econometrics (Shangai University of Finance)</a>
    </li>
    <li>
      <a href="anpreliminar.html">Análise preliminar de dados (Inclusão Financeira) (Shangai University of Finance)</a>
    </li>
    <li>
      <a href="fcast.html">Previsão (forecasting), simulação de cenários e análise de séries temporais</a>
    </li>
    <li>
      <a href="AtividadeIeII.html">Projeto Int. Transdiciplinar de Ciência de Dados</a>
    </li>
    <li>
      <a href="exerbolsadeestudos.html">Bolsa de Estudos x Matriculas: Uma abordagem de regressão bayesiana</a>
    </li>
    <li>
      <a href="prophet.html">Previsão (forecasting) de séries temporais financeiras com o ``Facebook Prophet``</a>
    </li>
    <li>
      <a href="prophet_boost.html">Forecasting de séries temporais com algoritmos de machine learning</a>
    </li>
    <li>
      <a href="causalimpact.html">Análise de Intervenção em Séries Temporais com o algoritmo do Google ´´CausalImpact``</a>
    </li>
    <li>
      <a href="modelo_deep_learning_series_temporais.html">Modelos de Deep Learning em Séries Temporais de preços de commodities</a>
    </li>
    <li>
      <a href="ETL_R_no_PowerBI.html">ETL com o R direto no Power BI</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://rhozon.github.io/PortfolioRodrigo.html">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/rhozon">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/rodrigohermontozon/">
    <span class="fa fa-linkedin"></span>
     
  </a>
</li>
<li>
  <a href="https://api.whatsapp.com/send?phone=5541988382904&amp;text=">
    <span class="fa fa-whatsapp"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Fazendo um ETL com R no Power BI</h1>
<h4 class="author">Rodrigo Hermont Ozon</h4>
<h4 class="date">Last Update: dezembro 12, 2021 07:58:39</h4>

</div>


<pre class="r"><code>start_time &lt;- Sys.time()</code></pre>
<style type="text/css">

#TOC {
  left: 220px;
  margin: 50px 30px 55px 30px;
}

.main-container {
    margin-left: 300px;
}


</style>
<hr />
<style>
p.comment {
background-color: #DBDBDB;
padding: 10px;
border: 1px solid black;
margin-left: 25px;
border-radius: 5px;
font-style: italic;
}

</style>
<div class="alert alert-info">
<p><strong> ETL no R + DataViz no Power BI </strong></p>
</div>
<hr />
<p><left> logo aqui </left></p>
<hr />
<center>
<p >
<p style="font-family: times, serif; font-size:11pt; font-style:italic"; class="comment">

Neste post demonstro com facilmente podemos fazer um ETL combinando um script feito em R para visualizarmos diretamente no Power BI

</p>
</center>
<hr />
<!-- Next Section-------------------------------------------------------------------------------------------------------------- -->
<!-- comment ----------------------------------------------------------------------------------------------------------------- -->
<!-- Next Section-------------------------------------------------------------------------------------------------------------- -->
<div id="dataset-a-ser-extraído" class="section level1">
<h1>Dataset a ser extraído</h1>
<p>Os dados que iremos utilizar são referentes as <em>commodities</em> milho, soja, óleo de soja e seus derivados. Estão disponíveis no site do órgão do governo norte-americano, <a href="https://apps.fas.usda.gov/export-sales/wkHistData.htm">USDA e podem ser acessados aqui.</a>. Vale destacar que o USDA possui uma API para obtenção mais facilitada destes dados, todavia, para fins didáticos faremos uma espécie de <em>web scrapping</em> de algumas tabelas que eles disponibilizam e adapteremos algumas métricas e valores para inserirmos em nossa visualização no Power BI.</p>
<p>Começaremos nossa extração aqui no R com os dados do milho ( <a href="https://apps.fas.usda.gov/export-sales/h401.htm" class="uri">https://apps.fas.usda.gov/export-sales/h401.htm</a> ). Mas primeiramente precisaremos instalar alguns pacotes do R no seu RStudio caso você ainda não os possua localmente (assume-se que você já tenha o R e o RStudio em seu computador pra isso, óbvio!)</p>
<p>Então abra o seu RStudio e no Console insira os seguintes comandos:</p>
<pre class="r"><code>install.packages(c(
  &quot;rvest&quot;,
  &quot;tidyr&quot;,
  &quot;dplyr&quot;,
  &quot;tidyverse&quot;,
  &quot;tsibble&quot;,
  &quot;fpp3&quot;,
  &quot;xlsx&quot;,
  &quot;DT&quot;
  &quot;stringr&quot;
))</code></pre>
<p>Agora irei descrever neste <em>post</em> como faremos nosso ETL diretamente no Power BI e caso você deseje reproduzi-lo fica tudo mais fácil! Vamos começar fazendo um <em>scrapping</em> dos dados do site referido.</p>
<p>Here we go!</p>
<p>Antes de tudo, chame os pacotes do R:</p>
<pre class="r"><code>library(rvest)
library(lubridate)
#library(tidyr)
library(dplyr)
library(tidyverse)
library(tsibble)
library(fpp3)
library(xlsx)
library(DT)
library(xts)
library(stringr)</code></pre>
<div id="extração-dos-dados-do-milho" class="section level2">
<h2>Extração dos dados do milho</h2>
<p>Note que o lugar onde os dados são divulgados pelo USDA na web é um arquivo do tipo .html. Assim, utilizaremos aqui o pacote do R <code>rvest</code> para fazer o scrapping de lá.</p>
<pre class="r"><code>url_milho &lt;-  &quot;https://apps.fas.usda.gov/export-sales/h401.htm&quot;

df_milho &lt;- url_milho %&gt;% 
  read_html() %&gt;% 
  html_nodes(&quot;table&quot;) %&gt;% 
  html_table(fill = TRUE) %&gt;%
  as.data.frame()

convert.brackets &lt;- function(x){
  if(grepl(&quot;\\(.*\\)&quot;, x)){
    paste0(&quot;-&quot;, gsub(&quot;\\(|\\)&quot;, &quot;&quot;, x))
  } else {
    x
  }
} # Funcao que converte os valores em parentesis para numeros negativos

df_milho &lt;- df_milho[-c(1, 2, 3, 4),] %&gt;% # remove as 4 primeiras linhas
  rename(
    
    Week_Ending_Corn = &quot;X1&quot;,
    Weekly_Exports_Corn = &quot;X2&quot;,
    Accumulated_Exports_Corn = &quot;X3&quot;,
    Net_Sales_Corn = &quot;X4&quot;,
    Outstanding_Sales_Corn = &quot;X5&quot;,
    Net_Sales_Next_Market_Year_Corn = &quot;X6&quot;,
    Outstanding_Sales_Next_Market_Year_Corn = &quot;X7&quot;
    
  )</code></pre>
<p>Agora temos a tabelona completa do site do USDA sem os nossos tratamentos. Agora faremos nossas manipulações nessa tabela com a finalidade de utilizarmos somente aquelas colunas que nos convém.</p>
<pre class="r"><code>df_milho &lt;- df_milho %&gt;%
  mutate( # dentro da funcao mutate() e manipulacao dos dados originais ou criacao de coluna na tabela
    
    day   = str_sub(Week_Ending_Corn, start = 4, end = 5), # Conta os caracteres que comecam no 4 e terminam no 5
    day   = format(day, format = &quot;%d&quot;),
    
    month = str_extract(Week_Ending_Corn, &quot;^.{2}&quot;), # EExtrai os 2 primeiros caracteres
    month = format(month, format = &quot;%m&quot;),
    Month_number = as.numeric(month),
    Month = month.name[Month_number],
    Month_Corn = Month,
    
    year  = str_sub(Week_Ending_Corn, start = 7, end = 10),
    year  = format(year, format = &quot;%y&quot;),
    Year_Corn  = as.numeric(year),
    
    Week_Ending_Corn = paste( year, &quot;-&quot; , month, &quot;-&quot; , day ),
    Week_Ending_Corn = gsub(&quot; &quot;, &quot;&quot;, Week_Ending_Corn ),
    Week_Ending_Corn = as_date(Week_Ending_Corn, &quot;%Y-%m-%d&quot;),
    
    YearMonth = yearmonth( Week_Ending_Corn),
    
    Weekly_Exports_Corn = gsub(&quot;,&quot;, &quot;&quot;, Weekly_Exports_Corn ),
    Weekly_Exports_Corn = as.numeric(Weekly_Exports_Corn),
    
    Accumulated_Exports_Corn = gsub(&quot;,&quot;, &quot;&quot;, Accumulated_Exports_Corn ),
    Accumulated_Exports_Corn = as.numeric(Accumulated_Exports_Corn),
    
    Net_Sales_Corn = sapply(Net_Sales_Corn, convert.brackets, USE.NAMES = F),
    Net_Sales_Corn = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Corn ),
    Net_Sales_Corn = as.numeric(Net_Sales_Corn),
    
    Outstanding_Sales_Corn = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Corn ),
    Outstanding_Sales_Corn = as.numeric(Outstanding_Sales_Corn),
    
    Net_Sales_Next_Market_Year_Corn = sapply(Net_Sales_Next_Market_Year_Corn, convert.brackets, USE.NAMES = F),
    Net_Sales_Next_Market_Year_Corn = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Next_Market_Year_Corn ),
    Net_Sales_Next_Market_Year_Corn = as.numeric(Net_Sales_Next_Market_Year_Corn),
    
    Outstanding_Sales_Next_Market_Year_Corn = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Next_Market_Year_Corn ),
    Outstanding_Sales_Next_Market_Year_Corn = as.numeric(Outstanding_Sales_Next_Market_Year_Corn),
    
    Month_Number = case_when(
      
      Month == &quot;January&quot; ~ 5,
      Month == &quot;February&quot; ~ 6,
      Month == &quot;March&quot; ~ 7,
      Month == &quot;April&quot; ~ 8,
      Month == &quot;May&quot; ~ 9,
      Month == &quot;June&quot;   ~ 10,
      Month == &quot;July&quot; ~ 11,
      Month == &quot;August&quot; ~   12,
      Month == &quot;September&quot; ~ 1,
      Month == &quot;October&quot; ~ 2,
      Month == &quot;November&quot; ~ 3,
      Month == &quot;December&quot;   ~ 4
    ),
    
    Accumulated_Sales_Corn = Accumulated_Exports_Corn + Outstanding_Sales_Corn,
    
  )

df_milho &lt;- df_milho %&gt;%
  mutate(
    Year_Exp = case_when(
      
      Month_Number ==  5 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  6 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  7 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  8 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  9 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == 10 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 11 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 12 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Corn == &quot;September&quot; ~ paste(as.numeric(Year_Corn),&quot;/&quot;,as.numeric(Year_Corn) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;%
  mutate(
    Year_Exp = gsub(&quot; &quot;, &quot;&quot;, Year_Exp)
  )

df_milho &lt;- df_milho %&gt;%
  select(
    Week_Ending_Corn,
    Month_number,
    Month,
    Year_Exp,
    Weekly_Exports_Corn,
    Accumulated_Exports_Corn,
    Net_Sales_Corn,
    Outstanding_Sales_Corn,
    Net_Sales_Next_Market_Year_Corn,
    Year_Corn,
    Outstanding_Sales_Next_Market_Year_Corn,
    Accumulated_Sales_Corn
    
  )

df_milho &lt;- df_milho[-nrow(df_milho),] #remove a ultima linha (NA)  

Corn &lt;- df_milho</code></pre>
<p>E finalmente precisaremos do dataframe nomeado <code>Corn_M</code> que mensaliza os dados, ou seja, pega os valores de referência do último dia de cada mês/atualização que o USDA divulga, para a nossa view no Power BI:</p>
<pre class="r"><code>Corn_M &lt;- Corn %&gt;%
  rename(
    Accumulated_Exp_Corn = &quot;Accumulated_Exports_Corn&quot;,
    Month_Corn = &quot;Month&quot;
  ) %&gt;%
  
  select(
    Week_Ending_Corn,
    Month_Corn,
    Year_Corn,
    Accumulated_Exp_Corn,
    Accumulated_Sales_Corn
  ) %&gt;%
  mutate(
    Month_Number = case_when(
      
                      Month_Corn == &quot;January&quot; ~ 5,
                      Month_Corn == &quot;February&quot; ~    6,
                      Month_Corn == &quot;March&quot; ~ 7,
                      Month_Corn == &quot;April&quot; ~ 8,
                      Month_Corn == &quot;May&quot; ~ 9,
                      Month_Corn == &quot;June&quot;  ~ 10,
                      Month_Corn == &quot;July&quot; ~    11,
                      Month_Corn == &quot;August&quot; ~  12,
                      Month_Corn == &quot;September&quot; ~ 1,
                      Month_Corn == &quot;October&quot; ~ 2,
                      Month_Corn == &quot;November&quot; ~    3,
                      Month_Corn == &quot;December&quot;  ~ 4  )
  ) %&gt;% 
  
  select(
    Week_Ending_Corn,
    Accumulated_Exp_Corn,
    Accumulated_Sales_Corn,
    Month_Corn,
    Year_Corn,
    #Year_Exp,
    Month_Number
  )</code></pre>
<pre class="r"><code># Converting the dataset for use the last values of each month

Corn_M_xts &lt;- xts(Corn_M[,-1], order.by = Corn_M[,1]) 

dataset_monthly &lt;- aggregate(Corn_M_xts, as.Date(as.yearmon(time(Corn_M_xts))), last) %&gt;% # Using the last value in each month
  as.data.frame()
# datatable(dataset_monthly)

Corn_M &lt;- dataset_monthly %&gt;%
  mutate( # including again the Year_Exp
    
    Year_Exp = case_when(
      
      Month_Number == &quot; 5&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 6&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 7&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 8&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 9&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == &quot;10&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;11&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;12&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Corn == &quot;September&quot; ~ paste(as.numeric(Year_Corn),&quot;/&quot;,as.numeric(Year_Corn) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;% 
  mutate(
    Year_Exp = gsub(&quot; &quot;,&quot;&quot;, Year_Exp)
  )


Corn_M &lt;- data.frame(
  
  Corn_M$Accumulated_Exp_Corn,
  Corn_M$Accumulated_Sales_Corn,
  Corn_M$Month_Corn,
  Corn_M$Year_Corn,
  Corn_M$Year_Exp,
  Corn_M$Month_Number
) %&gt;%
  rename(
    Accumulated_Exp_Corn = &quot;Corn_M.Accumulated_Exp_Corn&quot;,
    Accumulated_Sales_Corn = &quot;Corn_M.Accumulated_Sales_Corn&quot;,
    Month_Corn = &quot;Corn_M.Month_Corn&quot;,
    Year_Corn = &quot;Corn_M.Year_Corn&quot;,
    Year_Exp = &quot;Corn_M.Year_Exp&quot;,
    Month_Number = &quot;Corn_M.Month_Number&quot;
  ) %&gt;%
  mutate(
    
    Accumulated_Exp_Corn = as.numeric(Accumulated_Exp_Corn),
    Accumulated_Sales_Corn = as.numeric(Accumulated_Sales_Corn),
    Year_Corn = as.numeric(Year_Corn),
    Month_Number = as.numeric(Month_Number)
    
  )</code></pre>
<p>Pra ficar um pouco mais paupável gero um preview do nosso <em>dataset</em> após os tratamentos que fizemos para os dados do milho:</p>
<pre class="r"><code>datatable(Corn_M, caption = &#39;Corn USDA dataset (sheet = Corn_M)&#39;, filter = &#39;top&#39;, options = list(pageLength = 10, autoWidth = TRUE) ) </code></pre>
<div id="htmlwidget-ae5fc1924e27716436b2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ae5fc1924e27716436b2">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1606801\" data-max=\"66701906\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"9381817\" data-max=\"70023355\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1990\" data-max=\"2021\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","caption":"<caption>Corn USDA dataset (sheet = Corn_M)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384"],[25709501,30609978,35902753,40942976,46385882,51349320,54565359,58725579,2286606,4777774,9439457,13039300,17290931,21759197,25667164,29340035,32680730,35021643,38613234,42987230,2616174,6872270,9899915,12502357,15515685,18467010,21595653,25518241,27958167,31214653,35320107,39080158,2755250,6883303,10879085,15903682,19248373,22781672,25970739,29548251,32021069,34834187,37306282,40372509,3121704,6551757,9825466,13950405,16400966,18564054,21439880,23291853,25058740,27178743,28897212,32167397,2639955,5335125,9477921,15209451,19939448,24788752,30482814,34429769,38866334,43831474,48328161,54742387,5303305,10037635,15972530,20298921,24990932,30666535,35621122,40284242,45715209,49009953,52162736,55769486,1859925,5776059,10639462,15318888,20587376,24481646,28293513,31493347,35117696,37729181,41017696,44475869,2910203,6207418,9138309,12031143,15512590,18685113,21237778,24598520,27038947,29927843,33370282,36453772,2230422,6536082,10262503,15501187,18440726,22174709,26310375,31145275,34754763,39126021,44330907,48828576,4398150,8627062,12190498,17010421,20672924,24291271,28826818,32623914,35815604,39776038,43461143,48759454,4399744,8051600,12159239,15268996,18381612,21744454,26634891,30482110,33687656,36924264,41067260,47219290,3780162,6909431,10617862,13824978,17636867,21710074,26090043,29744900,34760627,38618364,42732284,47460442,2530104,5729192,9344622,13012711,16938215,19904058,22732402,25955088,29607401,32833484,36739317,39645678,3021027,7345827,11356392,15575770,20309686,23721850,28136229,32080558,35759093,39292871,43936680,47704214,3817840,7203043,11065384,16412693,19754513,22564350,26591558,30120726,33556647,38109733,41374597,44940766,3088505,7297946,10915289,15978413,19500074,23324698,28498645,32532823,37455356,43223243,47911376,54353593,4897927,8987836,14656309,18862827,22957232,27105773,32670859,36294434,41211052,44649785,48622533,53794282,4149742,9010701,16370503,21057262,27549873,32686837,37651097,42131621,46865730,51286105,55764349,59666423,3220196,6893562,10154546,12986721,16378176,19536721,23310329,27876346,31523142,34746159,40248634,44650039,3702422,7709912,10658575,14217822,17342111,20894078,25170158,30083600,34562120,38317589,43371215,47639868,4297137,7381821,10478987,14510111,17244828,20450545,25451336,29191070,32867331,37555435,41126023,44569181,2827117,5725580,9024375,13771168,16883421,20252831,24002499,27139657,30740589,33197220,35580665,37899629,2098731,3715757,5399449,6583166,8124260,9436966,11214313,12521483,13996587,15056414,16297488,17979535,1715326,4840966,7313321,10875148,14640523,18329259,22744125,27846521,33769728,37961256,43005924,46867610,3076944,6906928,9257486,12104584,15323510,18882161,22489437,27977038,32193879,36215706,41548064,45204579,2683245,5115810,6681154,9400863,11920079,14775046,19972404,24580133,28774084,35441415,40443213,45571268,5432218,8907814,11727671,16311789,19676709,24756236,32127954,37212993,41864134,47411394,51318700,55394769,3042675,5239973,8086569,10657999,13810928,17728765,24228973,30844547,39002891,45166174,50762349,57209372,4571760,9245664,14768361,18601639,19266614,26269301,30041052,34862968,40370526,42889698,45990688,48924131,1606801,3938985,6344393,8375027,11107254,14380182,18306607,24034226,29011059,33882600,38688838,42622199,2743037,6853890,10372851,15256327,20016748,26169851,33917646,43503345,51264764,57399582,63522803,66701906,2496613,5893473,9646679,10551311],[36611702,40630418,45661122,50908828,56450151,58142320,59319460,60023861,10482329,12982251,16873780,19816890,27603434,30657306,32732330,35398945,37868719,39988036,44044229,44875171,10350550,13952705,15746910,18970723,22226265,24736621,28994011,32298606,35375218,37667714,40547734,41098586,12132484,18482211,21056928,25327851,28374336,31477843,33752936,36431771,38512052,39948125,41014976,41623790,11002963,13946703,16392516,18871389,21922271,23288126,24751544,26088182,28219853,30905193,32331301,33595538,9563042,13685269,18624908,28611908,33286021,35979138,42153030,45838520,48365253,54096245,55701477,56765463,21479255,26794510,32853859,37660882,43802008,48930630,52285136,55567420,57695387,57703716,57581921,56771010,16573658,20073846,22861416,25494334,30021504,33705453,36438860,39224474,42496618,44538047,45406047,45517876,10602917,13506105,16702889,18665332,22043276,25443586,27788151,30010049,32580393,34752892,36910509,38331729,10398520,14737724,18937586,23280141,26873406,30713500,33388248,38710267,42727159,46460554,50476122,51263777,12434790,17045042,20577714,24904522,28251506,31808692,36076058,39500796,42704092,47003199,49576864,50765282,11394077,15138089,18305472,21966084,25453030,29046943,32972747,35650110,40340782,44456789,48178548,50025290,10798220,13697427,18253172,21172036,25580881,28995296,32878093,36266899,40979929,45240948,47757942,49542620,9381817,13358427,17266980,19574117,22205149,25369213,28303185,31334537,34896562,37950423,40590295,41545247,11295101,17552562,21669334,25339089,29352878,32816202,36585682,42295429,45208723,46826112,49106786,49881285,11214859,16542769,19982450,23387180,26011311,29514786,33986414,36686486,40225035,44087135,45872679,47721122,10823657,14651654,18674475,21969727,27358440,32259484,37253442,41235284,46172779,52223002,55025042,56807822,15604569,19784775,25985624,30365927,34756830,38189594,42326746,46174109,49853351,53027385,55892927,56565021,21490327,27817062,35414763,39860724,47349297,50672447,53522183,56191503,58590752,60010486,61441516,62527395,13522775,17079505,18678052,21040499,24875203,28992158,32967664,37928358,40909235,44231122,47319027,49047753,15530173,17849997,20573990,25377890,29116654,31997142,34496852,41421450,44824176,48706511,51403858,52392458,18067290,20179581,22868054,26324262,29249764,33969215,38912234,41006782,43482134,45822530,47361490,48109226,17109240,21089599,22137939,24671360,27622869,30853553,34066038,37303019,38463339,38939042,39312964,39581019,10429269,10910439,12229411,12756132,13656324,14496367,15520288,16749803,17383052,18167757,18818695,18979620,14635930,21954477,25212232,28066247,33210542,37530626,41253488,44007926,46148057,47212911,48735832,48648695,14513596,19220375,22749980,26954401,32147887,35626715,37388555,41158623,43460618,45674525,47126545,47419429,10513773,13144715,17078834,20452323,24225397,27650019,32588361,37856102,43133499,47252359,49035185,50089825,20603762,24751395,30082394,35732683,40217649,43408293,48561746,51815577,53667858,55602501,56358700,56405280,12095095,17028714,22899138,26671037,32251917,39268738,47352990,50935862,55300351,57693275,59366902,60571425,19698957,21832139,26747499,31827621,32287443,40525634,43195359,46057270,48238230,48915608,49885300,49934886,9711497,11893068,14615524,18354585,22790570,26642050,31907430,37453668,40472223,42313453,43782623,44587494,24622215,33189188,38293151,43944390,56106505,59123488,65726015,67856978,69108215,69547061,69723548,70023355,26581176,31008425,35430266,36562726],["January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December"],[1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021],["1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2021/2022","2021/2022","2021/2022","2021/2022"],[5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Accumulated_Exp_Corn<\/th>\n      <th>Accumulated_Sales_Corn<\/th>\n      <th>Month_Corn<\/th>\n      <th>Year_Corn<\/th>\n      <th>Year_Exp<\/th>\n      <th>Month_Number<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"autoWidth":true,"columnDefs":[{"className":"dt-right","targets":[1,2,4,6]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="extração-dos-dados-da-soja" class="section level2">
<h2>Extração dos dados da soja</h2>
<p>Seguindo exatamente a mesma lógica agora para os dados da soja, temos que: (Dados disponíveis em: <a href="https://apps.fas.usda.gov/export-sales/h801.htm" class="uri">https://apps.fas.usda.gov/export-sales/h801.htm</a> )</p>
<pre class="r"><code>url_soja &lt;-  &quot;https://apps.fas.usda.gov/export-sales/h801.htm&quot;

df_soja &lt;- url_soja %&gt;% 
  read_html() %&gt;% 
  html_nodes(&quot;table&quot;) %&gt;% 
  html_table(fill = TRUE) %&gt;%
  as.data.frame()

convert.brackets &lt;- function(x){
  if(grepl(&quot;\\(.*\\)&quot;, x)){
    paste0(&quot;-&quot;, gsub(&quot;\\(|\\)&quot;, &quot;&quot;, x))
  } else {
    x
  }
} # Function for convert parentheses to negative values

df_soja &lt;- df_soja[-c(1, 2, 3, 4),] %&gt;% # remove the fourth first lines
  rename(
  
    Week_Ending_Soybeans = &quot;X1&quot;,
    Weekly_Exports_Soybeans = &quot;X2&quot;,
    Accumulated_Exports_Soybeans = &quot;X3&quot;,
    Net_Sales_Soybeans = &quot;X4&quot;,
    Outstanding_Sales_Soybeans = &quot;X5&quot;,
    Net_Sales_Next_Market_Year_Soybeans = &quot;X6&quot;,
    Outstanding_Sales_Next_Market_Year_Soybeans = &quot;X7&quot;
  
  ) %&gt;%
    mutate( # all thongs inside mutate function is = data wrangling/manipulation
    
    day   = stringr::str_sub(Week_Ending_Soybeans, start = 4, end = 5), # Counting characters where begins and ends of
    day   = format(day, format = &quot;%d&quot;),
    
    month = stringr::str_extract(Week_Ending_Soybeans, &quot;^.{2}&quot;), # Extract the first 2 characters
    month = format(month, format = &quot;%m&quot;),
    Month_number = as.numeric(month),
    Month = month.name[Month_number],
    Month_Soybeans = Month,
    
    year  = stringr::str_sub(Week_Ending_Soybeans, start = 7, end = 10),
    year  = format(year, format = &quot;%y&quot;),
    Year_Soybeans  = as.numeric(year),
    
    Week_Ending_Soybeans = paste( year, &quot;-&quot; , month, &quot;-&quot; , day ),
    Week_Ending_Soybeans = gsub(&quot; &quot;, &quot;&quot;, Week_Ending_Soybeans ),
    Week_Ending_Soybeans = as_date(Week_Ending_Soybeans, &quot;%Y-%m-%d&quot;),
    
    YearMonth = yearmonth( Week_Ending_Soybeans),
    
    Weekly_Exports_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Weekly_Exports_Soybeans ),
    Weekly_Exports_Soybeans = as.numeric(Weekly_Exports_Soybeans),
    
    Accumulated_Exports_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Accumulated_Exports_Soybeans ),
    Accumulated_Exports_Soybeans = as.numeric(Accumulated_Exports_Soybeans),
    
    Net_Sales_Soybeans = sapply(Net_Sales_Soybeans, convert.brackets, USE.NAMES = F),
    Net_Sales_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Soybeans ),
    Net_Sales_Soybeans = as.numeric(Net_Sales_Soybeans),
    
    Outstanding_Sales_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Soybeans ),
    Outstanding_Sales_Soybeans = as.numeric(Outstanding_Sales_Soybeans),
    
    Net_Sales_Next_Market_Year_Soybeans = sapply(Net_Sales_Next_Market_Year_Soybeans, convert.brackets, USE.NAMES = F),
    Net_Sales_Next_Market_Year_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Next_Market_Year_Soybeans ),
    Net_Sales_Next_Market_Year_Soybeans = as.numeric(Net_Sales_Next_Market_Year_Soybeans),
    
    Outstanding_Sales_Next_Market_Year_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Next_Market_Year_Soybeans ),
    Outstanding_Sales_Next_Market_Year_Soybeans = as.numeric(Outstanding_Sales_Next_Market_Year_Soybeans),
    
    Month_Number = case_when(
      
      Month == &quot;January&quot;      ~ 5,
      Month == &quot;February&quot;     ~ 6,
      Month == &quot;March&quot;        ~ 7,
      Month == &quot;April&quot;        ~ 8,
      Month == &quot;May&quot;          ~ 9,
      Month == &quot;June&quot;           ~ 10,
      Month == &quot;July&quot;         ~ 11,
      Month == &quot;August&quot;       ~ 12,
      Month == &quot;September&quot;    ~ 1,
      Month == &quot;October&quot;      ~ 2,
      Month == &quot;November&quot;     ~ 3,
      Month == &quot;December&quot;       ~ 4
    ),
    
    Accumulated_Sales_Soybeans = Accumulated_Exports_Soybeans + Outstanding_Sales_Soybeans,
    
  )

df_soja &lt;- df_soja %&gt;%
  mutate(
    Year_Exp = case_when(
      
      Month_Number ==  5 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  6 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  7 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  8 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  9 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == 10 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 11 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 12 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Soybeans == &quot;September&quot; ~ paste(as.numeric(Year_Soybeans),&quot;/&quot;,as.numeric(Year_Soybeans) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;%
  mutate(
    Year_Exp = gsub(&quot; &quot;, &quot;&quot;, Year_Exp)
  )

df_soja &lt;- df_soja %&gt;%
  select(
    Week_Ending_Soybeans,
    Month_number,
    Month,
    Year_Exp,
    Weekly_Exports_Soybeans,
    Accumulated_Exports_Soybeans,
    Net_Sales_Soybeans,
    Outstanding_Sales_Soybeans,
    Net_Sales_Next_Market_Year_Soybeans,
    Year_Soybeans,
    Outstanding_Sales_Next_Market_Year_Soybeans,
    Accumulated_Sales_Soybeans
    
  )

df_soja &lt;- df_soja[-nrow(df_soja),] #remove the last row (NA)  

Soybeans &lt;- df_soja</code></pre>
<pre class="r"><code># Select the columns to be monthly

Soybeans_M &lt;- Soybeans %&gt;%
  rename(
    Accumulated_Exp_Soybeans = &quot;Accumulated_Exports_Soybeans&quot;,
    Month_Soybeans = &quot;Month&quot;
  ) %&gt;%
  
  select(
    Week_Ending_Soybeans,
    Month_Soybeans,
    Year_Soybeans,
    Accumulated_Exp_Soybeans,
    Accumulated_Sales_Soybeans
  ) %&gt;%
  mutate(
    Month_Number = case_when(
      
                      Month_Soybeans == &quot;January&quot;      ~  5,
                      Month_Soybeans == &quot;February&quot;     ~  6,
                      Month_Soybeans == &quot;March&quot;        ~  7,
                      Month_Soybeans == &quot;April&quot;        ~  8,
                      Month_Soybeans == &quot;May&quot;          ~  9,
                      Month_Soybeans == &quot;June&quot;         ~  10,
                      Month_Soybeans == &quot;July&quot;         ~  11,
                      Month_Soybeans == &quot;August&quot;       ~  12,
                      Month_Soybeans == &quot;September&quot;    ~  1,
                      Month_Soybeans == &quot;October&quot;      ~  2,
                      Month_Soybeans == &quot;November&quot;     ~  3,
                      Month_Soybeans == &quot;December&quot;     ~  4  )
  ) %&gt;% 
  
  select(
    Week_Ending_Soybeans,
    Accumulated_Exp_Soybeans,
    Accumulated_Sales_Soybeans,
    Month_Soybeans,
    Year_Soybeans,
    #Year_Exp,
    Month_Number
  )</code></pre>
<pre class="r"><code># Converting the dataset for use the last values of each month

Soybeans_M_xts &lt;- xts(Soybeans_M[,-1], order.by = Soybeans_M[,1]) 

dataset_monthly &lt;- aggregate(Soybeans_M_xts, as.Date(as.yearmon(time(Soybeans_M_xts))), last) %&gt;% # Using the last value in each month
  as.data.frame()
# datatable(dataset_monthly)

Soybeans_M &lt;- dataset_monthly %&gt;%
  mutate( # including again the Year_Exp
    
    Year_Exp = case_when(
      
      Month_Number == &quot; 5&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 6&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 7&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 8&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 9&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == &quot;10&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;11&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;12&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Soybeans == &quot;September&quot; ~ paste(as.numeric(Year_Soybeans),&quot;/&quot;,as.numeric(Year_Soybeans) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;% 
  mutate(
    Year_Exp = gsub(&quot; &quot;,&quot;&quot;, Year_Exp)
  )


Soybeans_M &lt;- data.frame(
  
  Soybeans_M$Accumulated_Exp_Soybeans,
  Soybeans_M$Accumulated_Sales_Soybeans,
  Soybeans_M$Month_Soybeans,
  Soybeans_M$Year_Soybeans,
  Soybeans_M$Year_Exp,
  Soybeans_M$Month_Number
) %&gt;%
  rename(
    Accumulated_Exp_Soybeans = &quot;Soybeans_M.Accumulated_Exp_Soybeans&quot;,
    Accumulated_Sales_Soybeans = &quot;Soybeans_M.Accumulated_Sales_Soybeans&quot;,
    Month_Soybeans = &quot;Soybeans_M.Month_Soybeans&quot;,
    Year_Soybeans = &quot;Soybeans_M.Year_Soybeans&quot;,
    Year_Exp = &quot;Soybeans_M.Year_Exp&quot;,
    Month_Number = &quot;Soybeans_M.Month_Number&quot;
  ) %&gt;%
  mutate(
    
    Accumulated_Exp_Soybeans = as.numeric(Accumulated_Exp_Soybeans),
    Accumulated_Sales_Soybeans = as.numeric(Accumulated_Sales_Soybeans), 
    Year_Soybeans = as.numeric(Year_Soybeans),
    Month_Number = as.numeric(Month_Number)
    
  )

#glimpse(Soyebans_M)

datatable(Soybeans_M, caption = &#39;Soybeans USDA dataset (sheet = Soybeans_M)&#39;, filter = &#39;top&#39;, options = list(pageLength = 10, autoWidth = TRUE) ) </code></pre>
<div id="htmlwidget-76967f780a124195042d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-76967f780a124195042d">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"461660\" data-max=\"60287413\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2664164\" data-max=\"62228103\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1990\" data-max=\"2021\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","caption":"<caption>Soybeans USDA dataset (sheet = Soybeans_M)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384"],[7513927,9668455,12492952,13713621,14547940,15292187,15926746,16815563,709444,1278184,3047852,4533668,6339244,8193290,9773050,11021505,12161492,13026193,14038872,15225874,566930,2372356,4069560,6528711,8840629,11466405,13184560,15023899,15751885,16541028,17878220,18958337,1224366,3661647,5917591,8623165,10751287,13471174,15855366,17370908,18278809,19279584,20738166,21511614,842471,2500764,4496032,6497635,8644897,10326742,11979581,13247365,13898976,14553426,15163485,16431571,1196715,3388681,5610722,8224827,11050033,13547911,16158562,18436671,19652007,20815261,21993282,23409753,1592129,3550080,6443243,8559690,11357157,14007257,16342867,17912295,19206658,20505471,21810255,23550389,1001076,3683031,7543570,10720977,14215603,17003981,19030125,20554388,21907276,22768106,23484225,24501137,678236,5150322,9274083,13124048,15974709,18610939,20402392,21550238,22330019,22883769,23656653,24425979,461660,3888600,7013729,9927803,12209336,14238746,16019963,17750458,18801563,19831250,20988412,22422346,1882977,4880040,7812346,11070448,13663611,16478970,19951154,21294962,22428175,23926935,25175345,26971981,1411343,4533768,8541976,11059149,13996307,17304493,21620001,23143144,24353730,25215769,26066565,27453963,731448,3495209,8992014,12383143,17121485,21069493,22990065,23989026,25633245,26915844,28243274,29838346,659218,4377300,8375879,11346569,16602244,20619502,23311199,24912616,26182645,26916659,28160870,28907535,567924,4861784,9587668,13355774,17314043,19719320,21420917,22355879,22894001,23377365,23839078,24107775,1187787,5358691,9833995,14676047,18152132,21405173,24732917,26487363,27667202,28643153,29195850,29878225,736567,4049436,7515000,10612538,13280295,16195774,19510505,20619843,21621692,22825894,23855610,25510276,1436950,5394898,9834289,13025195,16111972,19877221,23375212,25270288,26599712,27814581,28654928,30260972,1279347,4452382,8364683,11788576,16115118,19708528,22716013,24634673,26423554,27868545,29391183,30411331,481268,5139693,9526915,13501265,18071713,22383711,25143520,27592654,29293410,30709248,32360192,33705427,749922,5539209,12517145,19690685,25529382,30009402,33630034,35503910,36263825,37020547,38016078,39285005,1775458,8458487,15164598,21272063,25888480,31011619,34875764,36344129,37317472,38123607,38899891,39753448,1228654,5340790,10202261,15087465,19243329,23311638,27124726,29113749,31138850,32576740,34348655,36726621,2052562,8056450,16400164,21001992,27194591,30852474,32855976,34199490,34874876,35435311,35793751,36220167,967114,9080562,17211560,23356129,31452766,37182353,40494616,41989106,42928942,43492773,43999019,44414483,1293669,10329915,20316622,27953494,36516389,41237495,43866365,45564623,46593381,47629572,48655556,49613886,1358634,10905545,19418470,27037489,32275430,37899495,40966486,42225560,43002569,44070927,46181243,49821326,3439583,13259269,24130200,33103391,38824380,43493330,47334092,49841972,51156209,52883809,54720845,58117647,4001139,12186560,22970763,28179546,33216421,37769553,41578481,43485240,46604243,49552346,52369580,56107487,3021073,7385315,12986087,16943948,17851868,26482007,29940623,32199110,34912772,37779984,40940110,46188588,2853844,9333721,15987945,20844980,26770385,29588969,31607150,34033557,35705215,37076731,39960863,43785086,4565404,16578632,27059510,38871691,47391186,52538237,54739717,56328869,57454215,58272891,59315648,60287413,1844674,10581280,21070371,23504285],[10808687,12585674,13987347,14641362,15900503,16273101,16794947,17095857,2664164,4258335,6402356,7598461,9271050,10720550,11491737,12192865,13514409,14241105,14974326,15477233,3975470,6621882,8464341,10443086,12952557,14462362,15710137,16849100,17589938,18339566,19584823,19765351,6405316,9851376,11476651,13714121,16422377,17597926,18495346,19485104,20409926,21474340,21863102,21907633,3285059,5322110,6834634,9518662,11265137,12293519,13717292,14568285,15055624,15817776,16825389,17066938,9001584,11607489,13518009,15650928,16854188,18631547,20441688,21123736,22057254,22976680,23724226,23885665,6706560,9106939,11556325,14280894,16326007,18340839,19741193,21326146,22542747,23464115,24003494,24114737,6383065,11228472,14251973,16587505,18658617,20527866,21931915,23219016,23939890,24019353,24900927,25013779,10482177,13254933,15581234,18286075,19687276,21163084,22036717,22903766,23516474,24192133,24644445,24932474,7463512,10374232,11702704,14158671,15701031,17340752,18839107,19922306,20824344,21651521,22810150,23310055,7139189,10244291,12958584,15591454,17256876,20417150,22259694,23273435,24400886,26038918,26963481,27585315,7247495,10766724,14377491,17162925,20442096,23056943,24526998,25258428,26301074,27266134,27965681,28165273,7627606,11986028,17491018,20203793,23635812,25177463,25395464,26687293,28238725,29489607,30007179,30331903,7512708,12220203,15859136,19608269,23170193,24640453,26152056,27409806,28070060,28833359,29728795,29506695,10146413,16253269,18987538,21555172,22428764,22751306,23447409,24031004,24024262,24238648,24374782,24417525,9394284,12766948,16130836,20110071,23103306,25096226,27372690,28225568,29229110,29976607,30195092,30577438,6545090,9721930,11441043,14987603,17682922,19601930,21296012,22128732,23430198,24768973,25697304,26324096,10029019,13247683,16902432,19911443,22890002,25094312,27164600,27936845,28991541,30004485,30803942,31251072,10032267,12521637,18161745,20829138,24100831,25846237,27096566,28844870,30014339,30655430,31614308,31334385,10441485,15142588,17553150,20352088,24430881,27089057,29098007,32443933,33736268,34042486,35523695,36087201,20167401,23334069,27633454,32207225,34945932,35826492,36320962,37377544,38429746,39286274,40672178,41288616,22223951,28931176,32763136,35401308,38366812,39398362,40442652,41086314,41557000,41794805,41661026,42231127,16817427,18521869,21283218,24119607,26255529,28859681,31720051,34017528,36361333,37629243,38483918,38814260,23467822,25755194,28404199,30769423,34138914,34785204,35978113,36288965,36622002,36843235,37089788,37181446,26557271,33226149,37517420,40595584,42880434,44166261,44510524,44593250,44973660,45516002,46118938,45876799,28748235,35605032,39650360,42279218,45411026,47512615,48470813,49384988,50073154,50478588,50615655,50566277,20600426,27802093,32788011,37949783,40516690,42316639,44328605,46160263,47695267,51298205,52428700,52849380,28292981,36126429,41698274,47972651,50387719,52502533,55087559,56676149,58438066,59726566,60685377,60476650,23264194,30317643,36272213,40846535,43518300,45495576,51484176,54770352,55630121,57291981,58133183,58766320,20109004,21349227,23966895,30981160,30369061,39194457,43576509,45073368,46681934,48400072,48725040,48782678,14159041,20898326,25944284,29415787,32241831,34021232,36709106,39553618,42436538,44821879,46940617,47302579,38013249,48431847,52270683,54564787,58522985,60004013,60764636,61284690,61525174,61840549,61920153,62228103,25171186,32003967,37167029,38804917],["January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December"],[1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021],["1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2021/2022","2021/2022","2021/2022","2021/2022"],[5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Accumulated_Exp_Soybeans<\/th>\n      <th>Accumulated_Sales_Soybeans<\/th>\n      <th>Month_Soybeans<\/th>\n      <th>Year_Soybeans<\/th>\n      <th>Year_Exp<\/th>\n      <th>Month_Number<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"autoWidth":true,"columnDefs":[{"className":"dt-right","targets":[1,2,4,6]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="extração-de-soybean-cake-and-meal" class="section level2">
<h2>Extração de Soybean Cake and Meal</h2>
<p>Fonte: <a href="https://apps.fas.usda.gov/export-sales/h901.htm" class="uri">https://apps.fas.usda.gov/export-sales/h901.htm</a></p>
<pre class="r"><code>url_scm &lt;-  &quot;https://apps.fas.usda.gov/export-sales/h401.htm&quot;

df_scm &lt;- url_scm %&gt;% 
  read_html() %&gt;% 
  html_nodes(&quot;table&quot;) %&gt;% 
  html_table(fill = TRUE) %&gt;%
  as.data.frame()

convert.brackets &lt;- function(x){
  if(grepl(&quot;\\(.*\\)&quot;, x)){
    paste0(&quot;-&quot;, gsub(&quot;\\(|\\)&quot;, &quot;&quot;, x))
  } else {
    x
  }
} # Function for convert parentheses to negative values

df_scm &lt;- df_scm[-c(1, 2, 3, 4),] %&gt;% # remove the fourth first lines
  rename(
    
    Week_Ending_Meal = &quot;X1&quot;,
    Weekly_Exports_Meal = &quot;X2&quot;,
    Accumulated_Exports_Meal = &quot;X3&quot;,
    Net_Sales_Meal = &quot;X4&quot;,
    Outstanding_Sales_Meal = &quot;X5&quot;,
    Net_Sales_Next_Market_Year_Meal = &quot;X6&quot;,
    Outstanding_Sales_Next_Market_Year_Meal = &quot;X7&quot;
    
  ) %&gt;%
   mutate( # all thongs inside mutate function is = data wrangling/manipulation
    
    day   = stringr::str_sub(Week_Ending_Meal, start = 4, end = 5), # Counting characters where begins and ends of
    day   = format(day, format = &quot;%d&quot;),
    
    month = stringr::str_extract(Week_Ending_Meal, &quot;^.{2}&quot;), # Extract the first 2 characters
    month = format(month, format = &quot;%m&quot;),
    Month_number = as.numeric(month),
    Month = month.name[Month_number],
    Month_Meal = Month,
    
    year  = stringr::str_sub(Week_Ending_Meal, start = 7, end = 10),
    year  = format(year, format = &quot;%y&quot;),
    Year_Meal  = as.numeric(year),
    
    Week_Ending_Meal = paste( year, &quot;-&quot; , month, &quot;-&quot; , day ),
    Week_Ending_Meal = gsub(&quot; &quot;, &quot;&quot;, Week_Ending_Meal ),
    Week_Ending_Meal = as_date(Week_Ending_Meal, &quot;%Y-%m-%d&quot;),
    
    YearMonth = yearmonth( Week_Ending_Meal),
    
    Weekly_Exports_Meal = gsub(&quot;,&quot;, &quot;&quot;, Weekly_Exports_Meal ),
    Weekly_Exports_Meal = as.numeric(Weekly_Exports_Meal),
    
    Accumulated_Exports_Meal = gsub(&quot;,&quot;, &quot;&quot;, Accumulated_Exports_Meal ),
    Accumulated_Exports_Meal = as.numeric(Accumulated_Exports_Meal),
    
    Net_Sales_Meal = sapply(Net_Sales_Meal, convert.brackets, USE.NAMES = F),
    Net_Sales_Meal = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Meal ),
    Net_Sales_Meal = as.numeric(Net_Sales_Meal),
    
    Outstanding_Sales_Meal = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Meal ),
    Outstanding_Sales_Meal = as.numeric(Outstanding_Sales_Meal),
    
    Net_Sales_Next_Market_Year_Meal = sapply(Net_Sales_Next_Market_Year_Meal, convert.brackets, USE.NAMES = F),
    Net_Sales_Next_Market_Year_Meal = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Next_Market_Year_Meal ),
    Net_Sales_Next_Market_Year_Meal = as.numeric(Net_Sales_Next_Market_Year_Meal),
    
    Outstanding_Sales_Next_Market_Year_Meal = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Next_Market_Year_Meal ),
    Outstanding_Sales_Next_Market_Year_Meal = as.numeric(Outstanding_Sales_Next_Market_Year_Meal),
    
    Month_Number = case_when(
      
      Month == &quot;January&quot; ~ 5,
      Month == &quot;February&quot; ~ 6,
      Month == &quot;March&quot; ~ 7,
      Month == &quot;April&quot; ~ 8,
      Month == &quot;May&quot; ~ 9,
      Month == &quot;June&quot;   ~ 10,
      Month == &quot;July&quot; ~ 11,
      Month == &quot;August&quot; ~   12,
      Month == &quot;September&quot; ~ 1,
      Month == &quot;October&quot; ~ 2,
      Month == &quot;November&quot; ~ 3,
      Month == &quot;December&quot;   ~ 4
    ),
    
    Accumulated_Sales_Meal = Accumulated_Exports_Meal + Outstanding_Sales_Meal,
    
  )

df_scm &lt;- df_scm %&gt;%
  mutate(
    Year_Exp = case_when(
      
      Month_Number ==  5 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  6 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  7 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  8 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  9 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == 10 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 11 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 12 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Meal == &quot;September&quot; ~ paste(as.numeric(Year_Meal),&quot;/&quot;,as.numeric(Year_Meal) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;%
  mutate(
    Year_Exp = gsub(&quot; &quot;, &quot;&quot;, Year_Exp)
  )

df_scm &lt;- df_scm %&gt;%
  select(
    Week_Ending_Meal,
    Month_number,
    Month,
    Year_Exp,
    Weekly_Exports_Meal,
    Accumulated_Exports_Meal,
    Net_Sales_Meal,
    Outstanding_Sales_Meal,
    Net_Sales_Next_Market_Year_Meal,
    Year_Meal,
    Outstanding_Sales_Next_Market_Year_Meal,
    Accumulated_Sales_Meal
    
  )

df_scm &lt;- df_scm[-nrow(df_scm),] #remove the last row (NA)  

Meal &lt;- df_scm</code></pre>
<pre class="r"><code># Select the columns to be monthly

Meal_M &lt;- Meal %&gt;%
  rename(
    Accumulated_Exp_Meal = &quot;Accumulated_Exports_Meal&quot;,
    Month_Meal = &quot;Month&quot;
  ) %&gt;%
  
  select(
    Week_Ending_Meal,
    Month_Meal,
    Year_Meal,
    Accumulated_Exp_Meal,
    Accumulated_Sales_Meal
  ) %&gt;%
  mutate(
    Month_Number = case_when(
      
                      Month_Meal == &quot;January&quot; ~ 5,
                      Month_Meal == &quot;February&quot; ~    6,
                      Month_Meal == &quot;March&quot; ~ 7,
                      Month_Meal == &quot;April&quot; ~ 8,
                      Month_Meal == &quot;May&quot; ~ 9,
                      Month_Meal == &quot;June&quot;  ~ 10,
                      Month_Meal == &quot;July&quot; ~    11,
                      Month_Meal == &quot;August&quot; ~  12,
                      Month_Meal == &quot;September&quot; ~ 1,
                      Month_Meal == &quot;October&quot; ~ 2,
                      Month_Meal == &quot;November&quot; ~    3,
                      Month_Meal == &quot;December&quot;  ~ 4  )
  ) %&gt;% 
  
  select(
    Week_Ending_Meal,
    Accumulated_Exp_Meal,
    Accumulated_Sales_Meal,
    Month_Meal,
    Year_Meal,
    #Year_Exp,
    Month_Number
  )</code></pre>
<pre class="r"><code># Converting the dataset for use the last values of each month

Meal_M_xts &lt;- xts(Meal_M[,-1], order.by = Meal_M[,1]) 

dataset_monthly &lt;- aggregate(Meal_M_xts, as.Date(as.yearmon(time(Meal_M_xts))), last) %&gt;% # Using the last value in each month
  as.data.frame()
# datatable(dataset_monthly)

Meal_M &lt;- dataset_monthly %&gt;%
  mutate( # including again the Year_Exp
    
    Year_Exp = case_when(
      
      Month_Number == &quot; 5&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 6&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 7&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 8&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 9&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == &quot;10&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;11&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;12&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Meal == &quot;September&quot; ~ paste(as.numeric(Year_Meal),&quot;/&quot;,as.numeric(Year_Meal) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;% 
  mutate(
    Year_Exp = gsub(&quot; &quot;,&quot;&quot;, Year_Exp)
  )


Meal_M &lt;- data.frame(
  
  Meal_M$Accumulated_Exp_Meal,
  Meal_M$Accumulated_Sales_Meal,
  Meal_M$Month_Meal,
  Meal_M$Year_Meal,
  Meal_M$Year_Exp,
  Meal_M$Month_Number
) %&gt;%
  rename(
    Accumulated_Exp_Meal = &quot;Meal_M.Accumulated_Exp_Meal&quot;,
    Accumulated_Sales_Meal = &quot;Meal_M.Accumulated_Sales_Meal&quot;,
    Month_Meal = &quot;Meal_M.Month_Meal&quot;,
    Year_Meal = &quot;Meal_M.Year_Meal&quot;,
    Year_Exp = &quot;Meal_M.Year_Exp&quot;,
    Month_Number = &quot;Meal_M.Month_Number&quot;
  ) %&gt;%
  mutate(
    
    Accumulated_Exp_Meal = as.numeric(Accumulated_Exp_Meal),
    Accumulated_Sales_Meal = as.numeric(Accumulated_Sales_Meal),
    Year_Meal = as.numeric(Year_Meal),
    Month_Number = as.numeric(Month_Number)
    
  )

#glimpse(Meal_M)

datatable(Meal_M, caption = &#39;Meal USDA dataset (sheet = Meal_M)&#39;, filter = &#39;top&#39;, options = list(pageLength = 10, autoWidth = TRUE) ) </code></pre>
<div id="htmlwidget-105c92bd9228704ddbaa" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-105c92bd9228704ddbaa">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1606801\" data-max=\"66701906\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"9381817\" data-max=\"70023355\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1990\" data-max=\"2021\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","caption":"<caption>Meal USDA dataset (sheet = Meal_M)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384"],[25709501,30609978,35902753,40942976,46385882,51349320,54565359,58725579,2286606,4777774,9439457,13039300,17290931,21759197,25667164,29340035,32680730,35021643,38613234,42987230,2616174,6872270,9899915,12502357,15515685,18467010,21595653,25518241,27958167,31214653,35320107,39080158,2755250,6883303,10879085,15903682,19248373,22781672,25970739,29548251,32021069,34834187,37306282,40372509,3121704,6551757,9825466,13950405,16400966,18564054,21439880,23291853,25058740,27178743,28897212,32167397,2639955,5335125,9477921,15209451,19939448,24788752,30482814,34429769,38866334,43831474,48328161,54742387,5303305,10037635,15972530,20298921,24990932,30666535,35621122,40284242,45715209,49009953,52162736,55769486,1859925,5776059,10639462,15318888,20587376,24481646,28293513,31493347,35117696,37729181,41017696,44475869,2910203,6207418,9138309,12031143,15512590,18685113,21237778,24598520,27038947,29927843,33370282,36453772,2230422,6536082,10262503,15501187,18440726,22174709,26310375,31145275,34754763,39126021,44330907,48828576,4398150,8627062,12190498,17010421,20672924,24291271,28826818,32623914,35815604,39776038,43461143,48759454,4399744,8051600,12159239,15268996,18381612,21744454,26634891,30482110,33687656,36924264,41067260,47219290,3780162,6909431,10617862,13824978,17636867,21710074,26090043,29744900,34760627,38618364,42732284,47460442,2530104,5729192,9344622,13012711,16938215,19904058,22732402,25955088,29607401,32833484,36739317,39645678,3021027,7345827,11356392,15575770,20309686,23721850,28136229,32080558,35759093,39292871,43936680,47704214,3817840,7203043,11065384,16412693,19754513,22564350,26591558,30120726,33556647,38109733,41374597,44940766,3088505,7297946,10915289,15978413,19500074,23324698,28498645,32532823,37455356,43223243,47911376,54353593,4897927,8987836,14656309,18862827,22957232,27105773,32670859,36294434,41211052,44649785,48622533,53794282,4149742,9010701,16370503,21057262,27549873,32686837,37651097,42131621,46865730,51286105,55764349,59666423,3220196,6893562,10154546,12986721,16378176,19536721,23310329,27876346,31523142,34746159,40248634,44650039,3702422,7709912,10658575,14217822,17342111,20894078,25170158,30083600,34562120,38317589,43371215,47639868,4297137,7381821,10478987,14510111,17244828,20450545,25451336,29191070,32867331,37555435,41126023,44569181,2827117,5725580,9024375,13771168,16883421,20252831,24002499,27139657,30740589,33197220,35580665,37899629,2098731,3715757,5399449,6583166,8124260,9436966,11214313,12521483,13996587,15056414,16297488,17979535,1715326,4840966,7313321,10875148,14640523,18329259,22744125,27846521,33769728,37961256,43005924,46867610,3076944,6906928,9257486,12104584,15323510,18882161,22489437,27977038,32193879,36215706,41548064,45204579,2683245,5115810,6681154,9400863,11920079,14775046,19972404,24580133,28774084,35441415,40443213,45571268,5432218,8907814,11727671,16311789,19676709,24756236,32127954,37212993,41864134,47411394,51318700,55394769,3042675,5239973,8086569,10657999,13810928,17728765,24228973,30844547,39002891,45166174,50762349,57209372,4571760,9245664,14768361,18601639,19266614,26269301,30041052,34862968,40370526,42889698,45990688,48924131,1606801,3938985,6344393,8375027,11107254,14380182,18306607,24034226,29011059,33882600,38688838,42622199,2743037,6853890,10372851,15256327,20016748,26169851,33917646,43503345,51264764,57399582,63522803,66701906,2496613,5893473,9646679,10551311],[36611702,40630418,45661122,50908828,56450151,58142320,59319460,60023861,10482329,12982251,16873780,19816890,27603434,30657306,32732330,35398945,37868719,39988036,44044229,44875171,10350550,13952705,15746910,18970723,22226265,24736621,28994011,32298606,35375218,37667714,40547734,41098586,12132484,18482211,21056928,25327851,28374336,31477843,33752936,36431771,38512052,39948125,41014976,41623790,11002963,13946703,16392516,18871389,21922271,23288126,24751544,26088182,28219853,30905193,32331301,33595538,9563042,13685269,18624908,28611908,33286021,35979138,42153030,45838520,48365253,54096245,55701477,56765463,21479255,26794510,32853859,37660882,43802008,48930630,52285136,55567420,57695387,57703716,57581921,56771010,16573658,20073846,22861416,25494334,30021504,33705453,36438860,39224474,42496618,44538047,45406047,45517876,10602917,13506105,16702889,18665332,22043276,25443586,27788151,30010049,32580393,34752892,36910509,38331729,10398520,14737724,18937586,23280141,26873406,30713500,33388248,38710267,42727159,46460554,50476122,51263777,12434790,17045042,20577714,24904522,28251506,31808692,36076058,39500796,42704092,47003199,49576864,50765282,11394077,15138089,18305472,21966084,25453030,29046943,32972747,35650110,40340782,44456789,48178548,50025290,10798220,13697427,18253172,21172036,25580881,28995296,32878093,36266899,40979929,45240948,47757942,49542620,9381817,13358427,17266980,19574117,22205149,25369213,28303185,31334537,34896562,37950423,40590295,41545247,11295101,17552562,21669334,25339089,29352878,32816202,36585682,42295429,45208723,46826112,49106786,49881285,11214859,16542769,19982450,23387180,26011311,29514786,33986414,36686486,40225035,44087135,45872679,47721122,10823657,14651654,18674475,21969727,27358440,32259484,37253442,41235284,46172779,52223002,55025042,56807822,15604569,19784775,25985624,30365927,34756830,38189594,42326746,46174109,49853351,53027385,55892927,56565021,21490327,27817062,35414763,39860724,47349297,50672447,53522183,56191503,58590752,60010486,61441516,62527395,13522775,17079505,18678052,21040499,24875203,28992158,32967664,37928358,40909235,44231122,47319027,49047753,15530173,17849997,20573990,25377890,29116654,31997142,34496852,41421450,44824176,48706511,51403858,52392458,18067290,20179581,22868054,26324262,29249764,33969215,38912234,41006782,43482134,45822530,47361490,48109226,17109240,21089599,22137939,24671360,27622869,30853553,34066038,37303019,38463339,38939042,39312964,39581019,10429269,10910439,12229411,12756132,13656324,14496367,15520288,16749803,17383052,18167757,18818695,18979620,14635930,21954477,25212232,28066247,33210542,37530626,41253488,44007926,46148057,47212911,48735832,48648695,14513596,19220375,22749980,26954401,32147887,35626715,37388555,41158623,43460618,45674525,47126545,47419429,10513773,13144715,17078834,20452323,24225397,27650019,32588361,37856102,43133499,47252359,49035185,50089825,20603762,24751395,30082394,35732683,40217649,43408293,48561746,51815577,53667858,55602501,56358700,56405280,12095095,17028714,22899138,26671037,32251917,39268738,47352990,50935862,55300351,57693275,59366902,60571425,19698957,21832139,26747499,31827621,32287443,40525634,43195359,46057270,48238230,48915608,49885300,49934886,9711497,11893068,14615524,18354585,22790570,26642050,31907430,37453668,40472223,42313453,43782623,44587494,24622215,33189188,38293151,43944390,56106505,59123488,65726015,67856978,69108215,69547061,69723548,70023355,26581176,31008425,35430266,36562726],["January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December"],[1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021],["1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2021/2022","2021/2022","2021/2022","2021/2022"],[5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Accumulated_Exp_Meal<\/th>\n      <th>Accumulated_Sales_Meal<\/th>\n      <th>Month_Meal<\/th>\n      <th>Year_Meal<\/th>\n      <th>Year_Exp<\/th>\n      <th>Month_Number<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"autoWidth":true,"columnDefs":[{"className":"dt-right","targets":[1,2,4,6]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="soybean-oil" class="section level2">
<h2>Soybean Oil</h2>
<p>Fonte: <a href="https://apps.fas.usda.gov/export-sales/h902.htm" class="uri">https://apps.fas.usda.gov/export-sales/h902.htm</a></p>
<pre class="r"><code>url_oil &lt;-  &quot;https://apps.fas.usda.gov/export-sales/h902.htm&quot;

df_oil &lt;- url_oil %&gt;% 
  read_html() %&gt;% 
  html_nodes(&quot;table&quot;) %&gt;% 
  html_table(fill = TRUE) %&gt;%
  as.data.frame()

convert.brackets &lt;- function(x){
  if(grepl(&quot;\\(.*\\)&quot;, x)){
    paste0(&quot;-&quot;, gsub(&quot;\\(|\\)&quot;, &quot;&quot;, x))
  } else {
    x
  }
} # Function for convert parentheses to negative values

df_oil &lt;- df_oil[-c(1, 2, 3, 4),] %&gt;% # remove the fourth first lines
  rename(
    
    Week_Ending_Oil = &quot;X1&quot;,
    Weekly_Exports_Oil = &quot;X2&quot;,
    Accumulated_Exports_Oil = &quot;X3&quot;,
    Net_Sales_Oil = &quot;X4&quot;,
    Outstanding_Sales_Oil = &quot;X5&quot;,
    Net_Sales_Next_Market_Year_Oil = &quot;X6&quot;,
    Outstanding_Sales_Next_Market_Year_Oil = &quot;X7&quot;
    
  ) %&gt;%
  mutate( # all thongs inside mutate function is = data wrangling/manipulation
    
    day   = stringr::str_sub(Week_Ending_Oil, start = 4, end = 5), # Counting characters where begins and ends of
    day   = format(day, format = &quot;%d&quot;),
    
    month = stringr::str_extract(Week_Ending_Oil, &quot;^.{2}&quot;), # Extract the first 2 characters
    month = format(month, format = &quot;%m&quot;),
    Month_number = as.numeric(month),
    Month = month.name[Month_number],
    Month_Oil = Month,
    
    year  = stringr::str_sub(Week_Ending_Oil, start = 7, end = 10),
    year  = format(year, format = &quot;%y&quot;),
    Year_Oil  = as.numeric(year),
    
    Week_Ending_Oil = paste( year, &quot;-&quot; , month, &quot;-&quot; , day ),
    Week_Ending_Oil = gsub(&quot; &quot;, &quot;&quot;, Week_Ending_Oil ),
    Week_Ending_Oil = as_date(Week_Ending_Oil, &quot;%Y-%m-%d&quot;),
    
    YearMonth = yearmonth( Week_Ending_Oil),
    
    Weekly_Exports_Oil = gsub(&quot;,&quot;, &quot;&quot;, Weekly_Exports_Oil ),
    Weekly_Exports_Oil = as.numeric(Weekly_Exports_Oil),
    
    Accumulated_Exports_Oil = gsub(&quot;,&quot;, &quot;&quot;, Accumulated_Exports_Oil ),
    Accumulated_Exports_Oil = as.numeric(Accumulated_Exports_Oil),
    
    Net_Sales_Oil = sapply(Net_Sales_Oil, convert.brackets, USE.NAMES = F),
    Net_Sales_Oil = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Oil ),
    Net_Sales_Oil = as.numeric(Net_Sales_Oil),
    
    Outstanding_Sales_Oil = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Oil ),
    Outstanding_Sales_Oil = as.numeric(Outstanding_Sales_Oil),
    
    Net_Sales_Next_Market_Year_Oil = sapply(Net_Sales_Next_Market_Year_Oil, convert.brackets, USE.NAMES = F),
    Net_Sales_Next_Market_Year_Oil = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Next_Market_Year_Oil ),
    Net_Sales_Next_Market_Year_Oil = as.numeric(Net_Sales_Next_Market_Year_Oil),
    
    Outstanding_Sales_Next_Market_Year_Oil = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Next_Market_Year_Oil ),
    Outstanding_Sales_Next_Market_Year_Oil = as.numeric(Outstanding_Sales_Next_Market_Year_Oil),
    
    Month_Number = case_when(
      
      Month == &quot;January&quot; ~ 5,
      Month == &quot;February&quot; ~ 6,
      Month == &quot;March&quot; ~ 7,
      Month == &quot;April&quot; ~ 8,
      Month == &quot;May&quot; ~ 9,
      Month == &quot;June&quot;   ~ 10,
      Month == &quot;July&quot; ~ 11,
      Month == &quot;August&quot; ~   12,
      Month == &quot;September&quot; ~ 1,
      Month == &quot;October&quot; ~ 2,
      Month == &quot;November&quot; ~ 3,
      Month == &quot;December&quot;   ~ 4
    ),
    
    Accumulated_Sales_Oil = Accumulated_Exports_Oil + Outstanding_Sales_Oil,
    
  )

df_oil &lt;- df_oil %&gt;%
  mutate(
    Year_Exp = case_when(
      
      Month_Number ==  5 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  6 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  7 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  8 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  9 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == 10 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 11 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 12 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Oil == &quot;September&quot; ~ paste(as.numeric(Year_Oil),&quot;/&quot;,as.numeric(Year_Oil) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;%
  mutate(
    Year_Exp = gsub(&quot; &quot;, &quot;&quot;, Year_Exp)
  )

df_oil &lt;- df_oil %&gt;%
  select(
    Week_Ending_Oil,
    Month_number,
    Month,
    Year_Exp,
    Weekly_Exports_Oil,
    Accumulated_Exports_Oil,
    Net_Sales_Oil,
    Outstanding_Sales_Oil,
    Net_Sales_Next_Market_Year_Oil,
    Year_Oil,
    Outstanding_Sales_Next_Market_Year_Oil,
    Accumulated_Sales_Oil
    
  )

df_oil &lt;- df_oil[-nrow(df_oil),] #remove the last row (NA)  

Soybean_Oil &lt;- df_oil</code></pre>
<pre class="r"><code># Select the columns to be monthly

Oil_M &lt;- Soybean_Oil %&gt;%
  rename(
    Accumulated_Exp_Oil = &quot;Accumulated_Exports_Oil&quot;,
    Month_Oil = &quot;Month&quot;
  ) %&gt;%
  
  select(
    Week_Ending_Oil,
    Month_Oil,
    Year_Oil,
    Accumulated_Exp_Oil,
    Accumulated_Sales_Oil
  ) %&gt;%
  mutate(
    Month_Number = case_when(
      
                      Month_Oil == &quot;January&quot;      ~ 5,
                      Month_Oil == &quot;February&quot;     ~ 6,
                      Month_Oil == &quot;March&quot;        ~ 7,
                      Month_Oil == &quot;April&quot;        ~ 8,
                      Month_Oil == &quot;May&quot;          ~ 9,
                      Month_Oil == &quot;June&quot;         ~ 10,
                      Month_Oil == &quot;July&quot;         ~ 11,
                      Month_Oil == &quot;August&quot;       ~ 12,
                      Month_Oil == &quot;September&quot;    ~ 1,
                      Month_Oil == &quot;October&quot;      ~ 2,
                      Month_Oil == &quot;November&quot;     ~ 3,
                      Month_Oil == &quot;December&quot;     ~ 4  )
  ) %&gt;% 
  
  select(
    Week_Ending_Oil,
    Accumulated_Exp_Oil,
    Accumulated_Sales_Oil,
    Month_Oil,
    Year_Oil,
    #Year_Exp,
    Month_Number
  )</code></pre>
<pre class="r"><code># Converting the dataset for use the last values of each month

Oil_M_xts &lt;- xts(Oil_M[,-1], order.by = Oil_M[,1]) 

dataset_monthly &lt;- aggregate(Oil_M_xts, as.Date(as.yearmon(time(Oil_M_xts))), last) %&gt;% # Using the last value in each month
  as.data.frame()
# datatable(dataset_monthly)

Oil_M &lt;- dataset_monthly %&gt;%
  mutate( # including again the Year_Exp
    
    Year_Exp = case_when(
      
      Month_Number == &quot; 5&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 6&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 7&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 8&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 9&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == &quot;10&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;11&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;12&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Oil == &quot;September&quot; ~ paste(as.numeric(Year_Oil),&quot;/&quot;,as.numeric(Year_Oil) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;% 
  mutate(
    Year_Exp = gsub(&quot; &quot;,&quot;&quot;, Year_Exp)
  )


Oil_M &lt;- data.frame(
  
  Oil_M$Accumulated_Exp_Oil,
  Oil_M$Accumulated_Sales_Oil,
  Oil_M$Month_Oil,
  Oil_M$Year_Oil,
  Oil_M$Year_Exp,
  Oil_M$Month_Number
) %&gt;%
  rename(
    Accumulated_Exp_Oil = &quot;Oil_M.Accumulated_Exp_Oil&quot;,
    Accumulated_Sales_Oil = &quot;Oil_M.Accumulated_Sales_Oil&quot;,
    Month_Oil = &quot;Oil_M.Month_Oil&quot;,
    Year_Oil = &quot;Oil_M.Year_Oil&quot;,
    Year_Exp = &quot;Oil_M.Year_Exp&quot;,
    Month_Number = &quot;Oil_M.Month_Number&quot;
  ) %&gt;%
  mutate(
    
    Accumulated_Exp_Oil = as.numeric(Accumulated_Exp_Oil),
    Accumulated_Sales_Oil = as.numeric(Accumulated_Sales_Oil),
    Year_Oil = as.numeric(Year_Oil),
    Month_Number = as.numeric(Month_Number)
    
  )

#glimpse(Oil_M)

datatable(Oil_M, caption = &#39;Soybean Oil USDA dataset (sheet = Oil_M)&#39;, filter = &#39;top&#39;, options = list(pageLength = 10, autoWidth = TRUE) ) </code></pre>
<div id="htmlwidget-102482cddff783837948" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-102482cddff783837948">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"57\" data-max=\"1406754\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"38747\" data-max=\"1496326\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1990\" data-max=\"2021\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","caption":"<caption>Soybean Oil USDA dataset (sheet = Oil_M)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384"],[237044,266966,272838,292323,328340,374582,450273,483100,530694,57,46011,48131,50773,51972,53778,59674,87880,96680,151118,194045,246509,40662,66191,101813,168143,242490,275792,329693,357736,383318,422858,484759,520594,56990,110970,155959,200607,276162,326160,367893,407809,440780,462733,484660,514762,63548,80460,141303,190153,214866,254602,257422,259090,326272,335796,404933,507132,45495,131194,255561,345215,494772,676186,770489,797463,857690,879792,924653,944622,15104,48124,108949,117975,203123,207522,232206,236566,246662,248276,250816,257437,42311,162706,233960,333884,454120,535150,562989,590471,602402,656289,753941,804744,72883,215012,271102,491869,684213,868208,965031,1041715,1085605,1189878,1262205,1366974,84193,212203,381732,443263,512827,594801,672657,706967,755011,779516,789987,887217,28109,99910,136680,160638,207180,253411,279246,288630,299708,309103,329343,340253,7366,18812,94466,134870,216708,266328,280162,298880,302760,307017,316156,320040,44163,116942,144062,248452,405562,462758,522658,550410,641800,744613,772485,802775,34882,81721,116610,208506,334360,411139,504958,542642,568750,634010,666127,693358,23725,54997,80543,104752,124294,137233,150817,161656,176892,190237,210466,241906,16937,68567,155218,192988,276681,306521,326055,351031,374182,382701,408176,426594,20838,49658,95477,109390,114467,184237,219534,231866,262070,279184,312986,348912,31059,83860,185319,250827,303415,331342,352374,369579,406808,470455,555305,631180,36782,109891,208678,308114,508288,649734,797700,870633,934650,977746,1035859,1061727,43923,72067,108064,149232,207405,264740,445708,542493,584751,677318,785564,879945,159174,260643,405761,642007,763875,952306,1044435,1078656,1092546,1167452,1315522,1406754,173665,360616,488170,628476,802702,954915,1038471,1073508,1135658,1183369,1227496,1325031,28452,48750,98904,133033,195795,219825,247358,333149,382137,435433,514381,582410,104019,220025,332053,487899,626570,693113,745827,790348,812550,847209,864483,929318,34242,83096,187567,289876,421719,451618,543416,569935,599727,692103,739170,761417,52770,142286,256295,369848,437946,512825,592875,617557,677650,706852,784716,833303,55762,166205,334234,433826,473086,600166,646238,688875,761794,879383,928853,1045728,95683,177572,303815,387007,512402,636680,746248,808982,884089,970926,1054500,1100324,61516,119010,182123,253419,331982,429777,490600,698416,785385,859218,967293,1013813,53303,140061,183215,195224,337846,441139,472910,606701,634294,716579,756488,799262,104706,194823,270799,330060,486174,612606,710993,892443,976415,1077323,1134611,1218978,53805,100255,205145,340948,438253,531764,590713,617346,651804,665034,670319,675611,21133,91394,123092],[325779,348855,301181,321129,377385,497204,494628,502401,533447,45894,53534,55068,63835,73934,73867,89771,97505,139066,186941,245488,254927,97077,127895,272658,279214,317956,330507,369616,435819,444860,475700,510437,546231,134528,152057,237014,320422,351923,377625,422885,457836,458229,472305,515231,541889,120038,141743,221862,262367,289113,299820,333032,337304,329919,491290,523795,563265,344289,495076,684413,705671,751820,842924,872539,882640,910448,923545,948979,958809,105791,127480,164989,235052,230530,253821,251209,254545,255238,256305,258499,266644,152029,264848,386248,484817,595292,616677,616468,629821,669003,766760,824649,850924,239994,363874,638955,792645,933037,1036973,1042748,1146594,1230714,1351518,1435236,1496326,284661,418372,570934,627154,675076,742498,760128,784161,812788,837048,906989,929554,115717,168280,200349,236376,292933,321090,330477,323337,334038,340762,351865,355846,38747,111716,188157,239860,279947,293961,300414,305995,308938,320587,320181,327141,127140,185967,268482,445934,535583,575636,582519,709671,757095,787586,840800,845557,199501,232115,283825,422207,541313,583806,598445,638296,686248,702405,728975,753640,117807,144925,162956,175679,175376,185654,186662,195586,210567,218064,246635,253312,163344,198641,254693,319314,344769,359430,377875,386517,406187,415386,435749,446379,93107,150180,173511,200074,201839,254427,267569,278577,301109,302502,365044,380370,112946,211143,298573,352213,350249,376657,401025,411336,495854,566038,667403,686244,138003,312622,382066,643224,726682,877450,935813,1013761,1056017,1104562,1124244,1135103,172648,206678,207218,266839,380922,508410,653487,686417,791138,900153,916479,1026681,647583,704106,788819,953880,1101539,1137528,1168259,1191603,1347211,1429971,1460309,1492349,647139,744582,959810,1045484,1115753,1135249,1172530,1206834,1245918,1291219,1368156,1354013,86437,121892,170283,199405,272590,331316,372823,446238,488537,554137,612431,633136,267484,589847,663125,758803,779370,813053,831820,870392,888712,911597,938082,964627,145147,268359,362678,465936,549513,568871,583929,654973,758411,810644,809030,828016,251888,347850,429853,532168,579047,634707,678352,737436,755558,857676,883233,913472,403568,488311,550021,609019,629609,717250,749642,933432,1056284,1146142,1165935,1190847,322280,433565,552168,662564,749229,772169,832580,909308,989571,1052673,1122758,1141718,167912,223283,324104,420946,512678,692934,798758,885041,967931,1016084,1057294,1081832,224714,332430,403683,405903,516775,584718,669688,756486,804947,843851,891601,925873,236935,332278,425690,602307,732524,898996,1015289,1150115,1189349,1269347,1272878,1287657,228010,389936,491114,584189,597932,639155,668798,667809,677879,682634,690589,692305,133844,303104,308415],["January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December"],[1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2001,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2002,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2003,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2004,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2005,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2006,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2007,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2008,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2009,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021],["1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1989/1990","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1990/1991","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1991/1992","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1992/1993","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1993/1994","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1994/1995","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1995/1996","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1996/1997","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1997/1998","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1998/1999","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","1999/2000","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2000/2001","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2001/2002","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2002/2003","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2003/2004","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2004/2005","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2005/2006","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2006/2007","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2007/2008","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2008/2009","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2009/2010","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2010/2011","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2011/2012","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2012/2013","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2013/2014","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2014/2015","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2015/2016","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2016/2017","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2017/2018","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2018/2019","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2019/2020","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2020/2021","2021/2022","2021/2022","2021/2022","2021/2022"],[5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Accumulated_Exp_Oil<\/th>\n      <th>Accumulated_Sales_Oil<\/th>\n      <th>Month_Oil<\/th>\n      <th>Year_Oil<\/th>\n      <th>Year_Exp<\/th>\n      <th>Month_Number<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"autoWidth":true,"columnDefs":[{"className":"dt-right","targets":[1,2,4,6]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="relembrando" class="section level1">
<h1>Relembrando…</h1>
<p>Após abrir o seu RStudio e ter instalado os pacotes com o comando:</p>
<pre class="r"><code>install.packages(c(
  &quot;rvest&quot;,
  &quot;tidyr&quot;,
  &quot;dplyr&quot;,
  &quot;tidyverse&quot;,
  &quot;tsibble&quot;,
  &quot;fpp3&quot;,
  &quot;xlsx&quot;,
  &quot;DT&quot;
  &quot;stringr&quot;
))</code></pre>
<p>conforme explicado no início, agora partiremos pro Power BI Desktop…</p>
</div>
<div id="chamando-o-script-do-r-dentro-do-power-bi" class="section level1">
<h1>Chamando o script do R dentro do Power BI</h1>
<p>Antes de afobadamente você abrir seu Power BI, primeiro copie (CTRL+C) todo o conteúdo a seguir, que nada mais são do que as etapas do ETL que percorremos até aqui para cada uma das fontes de dados que utilizamos:</p>
<pre class="r"><code># Pacotes do R

library(rvest)
library(lubridate)
#library(tidyr)
library(dplyr)
library(tidyverse)
library(tsibble)
library(fpp3)
library(xlsx)
#library(DT)
library(xts)
library(stringr)

# ETL dos dados do USDA 

url_milho &lt;-  &quot;https://apps.fas.usda.gov/export-sales/h401.htm&quot;

df_milho &lt;- url_milho %&gt;% 
  read_html() %&gt;% 
  html_nodes(&quot;table&quot;) %&gt;% 
  html_table(fill = TRUE) %&gt;%
  as.data.frame()

convert.brackets &lt;- function(x){
  if(grepl(&quot;\\(.*\\)&quot;, x)){
    paste0(&quot;-&quot;, gsub(&quot;\\(|\\)&quot;, &quot;&quot;, x))
  } else {
    x
  }
} # Funcao que converte os valores em parentesis para numeros negativos

df_milho &lt;- df_milho[-c(1, 2, 3, 4),] %&gt;% # remove as 4 primeiras linhas
  rename(
    
    Week_Ending_Corn = &quot;X1&quot;,
    Weekly_Exports_Corn = &quot;X2&quot;,
    Accumulated_Exports_Corn = &quot;X3&quot;,
    Net_Sales_Corn = &quot;X4&quot;,
    Outstanding_Sales_Corn = &quot;X5&quot;,
    Net_Sales_Next_Market_Year_Corn = &quot;X6&quot;,
    Outstanding_Sales_Next_Market_Year_Corn = &quot;X7&quot;
    
  ) %&gt;%
  mutate( # dentro da funcao mutate() e manipulacao dos dados originais ou criacao de coluna na tabela
    
    day   = str_sub(Week_Ending_Corn, start = 4, end = 5), # Conta os caracteres que comecam no 4 e terminam no 5
    day   = format(day, format = &quot;%d&quot;),
    
    month = str_extract(Week_Ending_Corn, &quot;^.{2}&quot;), # EExtrai os 2 primeiros caracteres
    month = format(month, format = &quot;%m&quot;),
    Month_number = as.numeric(month),
    Month = month.name[Month_number],
    Month_Corn = Month,
    
    year  = str_sub(Week_Ending_Corn, start = 7, end = 10),
    year  = format(year, format = &quot;%y&quot;),
    Year_Corn  = as.numeric(year),
    
    Week_Ending_Corn = paste( year, &quot;-&quot; , month, &quot;-&quot; , day ),
    Week_Ending_Corn = gsub(&quot; &quot;, &quot;&quot;, Week_Ending_Corn ),
    Week_Ending_Corn = as_date(Week_Ending_Corn, &quot;%Y-%m-%d&quot;),
    
    YearMonth = yearmonth( Week_Ending_Corn),
    
    Weekly_Exports_Corn = gsub(&quot;,&quot;, &quot;&quot;, Weekly_Exports_Corn ),
    Weekly_Exports_Corn = as.numeric(Weekly_Exports_Corn),
    
    Accumulated_Exports_Corn = gsub(&quot;,&quot;, &quot;&quot;, Accumulated_Exports_Corn ),
    Accumulated_Exports_Corn = as.numeric(Accumulated_Exports_Corn),
    
    Net_Sales_Corn = sapply(Net_Sales_Corn, convert.brackets, USE.NAMES = F),
    Net_Sales_Corn = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Corn ),
    Net_Sales_Corn = as.numeric(Net_Sales_Corn),
    
    Outstanding_Sales_Corn = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Corn ),
    Outstanding_Sales_Corn = as.numeric(Outstanding_Sales_Corn),
    
    Net_Sales_Next_Market_Year_Corn = sapply(Net_Sales_Next_Market_Year_Corn, convert.brackets, USE.NAMES = F),
    Net_Sales_Next_Market_Year_Corn = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Next_Market_Year_Corn ),
    Net_Sales_Next_Market_Year_Corn = as.numeric(Net_Sales_Next_Market_Year_Corn),
    
    Outstanding_Sales_Next_Market_Year_Corn = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Next_Market_Year_Corn ),
    Outstanding_Sales_Next_Market_Year_Corn = as.numeric(Outstanding_Sales_Next_Market_Year_Corn),
    
    Month_Number = case_when(
      
      Month == &quot;January&quot; ~ 5,
      Month == &quot;February&quot; ~ 6,
      Month == &quot;March&quot; ~ 7,
      Month == &quot;April&quot; ~ 8,
      Month == &quot;May&quot; ~ 9,
      Month == &quot;June&quot;   ~ 10,
      Month == &quot;July&quot; ~ 11,
      Month == &quot;August&quot; ~   12,
      Month == &quot;September&quot; ~ 1,
      Month == &quot;October&quot; ~ 2,
      Month == &quot;November&quot; ~ 3,
      Month == &quot;December&quot;   ~ 4
    ),
    
    Accumulated_Sales_Corn = Accumulated_Exports_Corn + Outstanding_Sales_Corn,
    
  )

df_milho &lt;- df_milho %&gt;%
  mutate(
    Year_Exp = case_when(
      
      Month_Number ==  5 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  6 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  7 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  8 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  9 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == 10 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 11 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 12 &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Corn == &quot;September&quot; ~ paste(as.numeric(Year_Corn),&quot;/&quot;,as.numeric(Year_Corn) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;%
  mutate(
    Year_Exp = gsub(&quot; &quot;, &quot;&quot;, Year_Exp)
  )

df_milho &lt;- df_milho %&gt;%
  select(
    Week_Ending_Corn,
    Month_number,
    Month,
    Year_Exp,
    Weekly_Exports_Corn,
    Accumulated_Exports_Corn,
    Net_Sales_Corn,
    Outstanding_Sales_Corn,
    Net_Sales_Next_Market_Year_Corn,
    Year_Corn,
    Outstanding_Sales_Next_Market_Year_Corn,
    Accumulated_Sales_Corn
    
  )

df_milho &lt;- df_milho[-nrow(df_milho),] #remove a ultima linha (NA)  

Corn &lt;- df_milho


Corn_M &lt;- Corn %&gt;%
  rename(
    Accumulated_Exp_Corn = &quot;Accumulated_Exports_Corn&quot;,
    Month_Corn = &quot;Month&quot;
  ) %&gt;%
  
  select(
    Week_Ending_Corn,
    Month_Corn,
    Year_Corn,
    Accumulated_Exp_Corn,
    Accumulated_Sales_Corn
  ) %&gt;%
  mutate(
    Month_Number = case_when(
      
                      Month_Corn == &quot;January&quot; ~ 5,
                      Month_Corn == &quot;February&quot; ~    6,
                      Month_Corn == &quot;March&quot; ~ 7,
                      Month_Corn == &quot;April&quot; ~ 8,
                      Month_Corn == &quot;May&quot; ~ 9,
                      Month_Corn == &quot;June&quot;  ~ 10,
                      Month_Corn == &quot;July&quot; ~    11,
                      Month_Corn == &quot;August&quot; ~  12,
                      Month_Corn == &quot;September&quot; ~ 1,
                      Month_Corn == &quot;October&quot; ~ 2,
                      Month_Corn == &quot;November&quot; ~    3,
                      Month_Corn == &quot;December&quot;  ~ 4  )
  ) %&gt;% 
  
  select(
    Week_Ending_Corn,
    Accumulated_Exp_Corn,
    Accumulated_Sales_Corn,
    Month_Corn,
    Year_Corn,
    #Year_Exp,
    Month_Number
  )

# Converting the dataset for use the last values of each month

Corn_M_xts &lt;- xts(Corn_M[,-1], order.by = Corn_M[,1]) 

dataset_monthly &lt;- aggregate(Corn_M_xts, as.Date(as.yearmon(time(Corn_M_xts))), last) %&gt;% # Using the last value in each month
  as.data.frame()
# datatable(dataset_monthly)

Corn_M &lt;- dataset_monthly %&gt;%
  mutate( # including again the Year_Exp
    
    Year_Exp = case_when(
      
      Month_Number == &quot; 5&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 6&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 7&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 8&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 9&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == &quot;10&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;11&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;12&quot; &amp; Year_Corn == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Corn == &quot;September&quot; ~ paste(as.numeric(Year_Corn),&quot;/&quot;,as.numeric(Year_Corn) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;% 
  mutate(
    Year_Exp = gsub(&quot; &quot;,&quot;&quot;, Year_Exp)
  )


Corn_M &lt;- data.frame(
  
  Corn_M$Accumulated_Exp_Corn,
  Corn_M$Accumulated_Sales_Corn,
  Corn_M$Month_Corn,
  Corn_M$Year_Corn,
  Corn_M$Year_Exp,
  Corn_M$Month_Number
) %&gt;%
  rename(
    Accumulated_Exp_Corn = &quot;Corn_M.Accumulated_Exp_Corn&quot;,
    Accumulated_Sales_Corn = &quot;Corn_M.Accumulated_Sales_Corn&quot;,
    Month_Corn = &quot;Corn_M.Month_Corn&quot;,
    Year_Corn = &quot;Corn_M.Year_Corn&quot;,
    Year_Exp = &quot;Corn_M.Year_Exp&quot;,
    Month_Number = &quot;Corn_M.Month_Number&quot;
  ) %&gt;%
  mutate(
    
    Accumulated_Exp_Corn = as.numeric(Accumulated_Exp_Corn),
    Accumulated_Sales_Corn = as.numeric(Accumulated_Sales_Corn),
    Year_Corn = as.numeric(Year_Corn),
    Month_Number = as.numeric(Month_Number)
    
  )

url_soja &lt;-  &quot;https://apps.fas.usda.gov/export-sales/h801.htm&quot;

df_soja &lt;- url_soja %&gt;% 
  read_html() %&gt;% 
  html_nodes(&quot;table&quot;) %&gt;% 
  html_table(fill = TRUE) %&gt;%
  as.data.frame()

convert.brackets &lt;- function(x){
  if(grepl(&quot;\\(.*\\)&quot;, x)){
    paste0(&quot;-&quot;, gsub(&quot;\\(|\\)&quot;, &quot;&quot;, x))
  } else {
    x
  }
} # Function for convert parentheses to negative values

df_soja &lt;- df_soja[-c(1, 2, 3, 4),] %&gt;% # remove the fourth first lines
  rename(
  
    Week_Ending_Soybeans = &quot;X1&quot;,
    Weekly_Exports_Soybeans = &quot;X2&quot;,
    Accumulated_Exports_Soybeans = &quot;X3&quot;,
    Net_Sales_Soybeans = &quot;X4&quot;,
    Outstanding_Sales_Soybeans = &quot;X5&quot;,
    Net_Sales_Next_Market_Year_Soybeans = &quot;X6&quot;,
    Outstanding_Sales_Next_Market_Year_Soybeans = &quot;X7&quot;
  
  ) %&gt;%
    mutate( # all thongs inside mutate function is = data wrangling/manipulation
    
    day   = stringr::str_sub(Week_Ending_Soybeans, start = 4, end = 5), # Counting characters where begins and ends of
    day   = format(day, format = &quot;%d&quot;),
    
    month = stringr::str_extract(Week_Ending_Soybeans, &quot;^.{2}&quot;), # Extract the first 2 characters
    month = format(month, format = &quot;%m&quot;),
    Month_number = as.numeric(month),
    Month = month.name[Month_number],
    Month_Soybeans = Month,
    
    year  = stringr::str_sub(Week_Ending_Soybeans, start = 7, end = 10),
    year  = format(year, format = &quot;%y&quot;),
    Year_Soybeans  = as.numeric(year),
    
    Week_Ending_Soybeans = paste( year, &quot;-&quot; , month, &quot;-&quot; , day ),
    Week_Ending_Soybeans = gsub(&quot; &quot;, &quot;&quot;, Week_Ending_Soybeans ),
    Week_Ending_Soybeans = as_date(Week_Ending_Soybeans, &quot;%Y-%m-%d&quot;),
    
    YearMonth = yearmonth( Week_Ending_Soybeans),
    
    Weekly_Exports_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Weekly_Exports_Soybeans ),
    Weekly_Exports_Soybeans = as.numeric(Weekly_Exports_Soybeans),
    
    Accumulated_Exports_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Accumulated_Exports_Soybeans ),
    Accumulated_Exports_Soybeans = as.numeric(Accumulated_Exports_Soybeans),
    
    Net_Sales_Soybeans = sapply(Net_Sales_Soybeans, convert.brackets, USE.NAMES = F),
    Net_Sales_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Soybeans ),
    Net_Sales_Soybeans = as.numeric(Net_Sales_Soybeans),
    
    Outstanding_Sales_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Soybeans ),
    Outstanding_Sales_Soybeans = as.numeric(Outstanding_Sales_Soybeans),
    
    Net_Sales_Next_Market_Year_Soybeans = sapply(Net_Sales_Next_Market_Year_Soybeans, convert.brackets, USE.NAMES = F),
    Net_Sales_Next_Market_Year_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Next_Market_Year_Soybeans ),
    Net_Sales_Next_Market_Year_Soybeans = as.numeric(Net_Sales_Next_Market_Year_Soybeans),
    
    Outstanding_Sales_Next_Market_Year_Soybeans = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Next_Market_Year_Soybeans ),
    Outstanding_Sales_Next_Market_Year_Soybeans = as.numeric(Outstanding_Sales_Next_Market_Year_Soybeans),
    
    Month_Number = case_when(
      
      Month == &quot;January&quot;      ~ 5,
      Month == &quot;February&quot;     ~ 6,
      Month == &quot;March&quot;        ~ 7,
      Month == &quot;April&quot;        ~ 8,
      Month == &quot;May&quot;          ~ 9,
      Month == &quot;June&quot;           ~ 10,
      Month == &quot;July&quot;         ~ 11,
      Month == &quot;August&quot;       ~ 12,
      Month == &quot;September&quot;    ~ 1,
      Month == &quot;October&quot;      ~ 2,
      Month == &quot;November&quot;     ~ 3,
      Month == &quot;December&quot;       ~ 4
    ),
    
    Accumulated_Sales_Soybeans = Accumulated_Exports_Soybeans + Outstanding_Sales_Soybeans,
    
  )

df_soja &lt;- df_soja %&gt;%
  mutate(
    Year_Exp = case_when(
      
      Month_Number ==  5 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  6 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  7 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  8 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  9 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == 10 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 11 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 12 &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Soybeans == &quot;September&quot; ~ paste(as.numeric(Year_Soybeans),&quot;/&quot;,as.numeric(Year_Soybeans) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;%
  mutate(
    Year_Exp = gsub(&quot; &quot;, &quot;&quot;, Year_Exp)
  )

df_soja &lt;- df_soja %&gt;%
  select(
    Week_Ending_Soybeans,
    Month_number,
    Month,
    Year_Exp,
    Weekly_Exports_Soybeans,
    Accumulated_Exports_Soybeans,
    Net_Sales_Soybeans,
    Outstanding_Sales_Soybeans,
    Net_Sales_Next_Market_Year_Soybeans,
    Year_Soybeans,
    Outstanding_Sales_Next_Market_Year_Soybeans,
    Accumulated_Sales_Soybeans
    
  )

df_soja &lt;- df_soja[-nrow(df_soja),] #remove the last row (NA)  

Soybeans &lt;- df_soja

# Select the columns to be monthly

Soybeans_M &lt;- Soybeans %&gt;%
  rename(
    Accumulated_Exp_Soybeans = &quot;Accumulated_Exports_Soybeans&quot;,
    Month_Soybeans = &quot;Month&quot;
  ) %&gt;%
  
  select(
    Week_Ending_Soybeans,
    Month_Soybeans,
    Year_Soybeans,
    Accumulated_Exp_Soybeans,
    Accumulated_Sales_Soybeans
  ) %&gt;%
  mutate(
    Month_Number = case_when(
      
                      Month_Soybeans == &quot;January&quot;      ~  5,
                      Month_Soybeans == &quot;February&quot;     ~  6,
                      Month_Soybeans == &quot;March&quot;        ~  7,
                      Month_Soybeans == &quot;April&quot;        ~  8,
                      Month_Soybeans == &quot;May&quot;          ~  9,
                      Month_Soybeans == &quot;June&quot;         ~  10,
                      Month_Soybeans == &quot;July&quot;         ~  11,
                      Month_Soybeans == &quot;August&quot;       ~  12,
                      Month_Soybeans == &quot;September&quot;    ~  1,
                      Month_Soybeans == &quot;October&quot;      ~  2,
                      Month_Soybeans == &quot;November&quot;     ~  3,
                      Month_Soybeans == &quot;December&quot;     ~  4  )
  ) %&gt;% 
  
  select(
    Week_Ending_Soybeans,
    Accumulated_Exp_Soybeans,
    Accumulated_Sales_Soybeans,
    Month_Soybeans,
    Year_Soybeans,
    #Year_Exp,
    Month_Number
  )

# Converting the dataset for use the last values of each month

Soybeans_M_xts &lt;- xts(Soybeans_M[,-1], order.by = Soybeans_M[,1]) 

dataset_monthly &lt;- aggregate(Soybeans_M_xts, as.Date(as.yearmon(time(Soybeans_M_xts))), last) %&gt;% # Using the last value in each month
  as.data.frame()
# datatable(dataset_monthly)

Soybeans_M &lt;- dataset_monthly %&gt;%
  mutate( # including again the Year_Exp
    
    Year_Exp = case_when(
      
      Month_Number == &quot; 5&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 6&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 7&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 8&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 9&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == &quot;10&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;11&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;12&quot; &amp; Year_Soybeans == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Soybeans == &quot;September&quot; ~ paste(as.numeric(Year_Soybeans),&quot;/&quot;,as.numeric(Year_Soybeans) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;% 
  mutate(
    Year_Exp = gsub(&quot; &quot;,&quot;&quot;, Year_Exp)
  )


Soybeans_M &lt;- data.frame(
  
  Soybeans_M$Accumulated_Exp_Soybeans,
  Soybeans_M$Accumulated_Sales_Soybeans,
  Soybeans_M$Month_Soybeans,
  Soybeans_M$Year_Soybeans,
  Soybeans_M$Year_Exp,
  Soybeans_M$Month_Number
) %&gt;%
  rename(
    Accumulated_Exp_Soybeans = &quot;Soybeans_M.Accumulated_Exp_Soybeans&quot;,
    Accumulated_Sales_Soybeans = &quot;Soybeans_M.Accumulated_Sales_Soybeans&quot;,
    Month_Soybeans = &quot;Soybeans_M.Month_Soybeans&quot;,
    Year_Soybeans = &quot;Soybeans_M.Year_Soybeans&quot;,
    Year_Exp = &quot;Soybeans_M.Year_Exp&quot;,
    Month_Number = &quot;Soybeans_M.Month_Number&quot;
  ) %&gt;%
  mutate(
    
    Accumulated_Exp_Soybeans = as.numeric(Accumulated_Exp_Soybeans),
    Accumulated_Sales_Soybeans = as.numeric(Accumulated_Sales_Soybeans), 
    Year_Soybeans = as.numeric(Year_Soybeans),
    Month_Number = as.numeric(Month_Number)
    
  )

url_scm &lt;-  &quot;https://apps.fas.usda.gov/export-sales/h401.htm&quot;

df_scm &lt;- url_scm %&gt;% 
  read_html() %&gt;% 
  html_nodes(&quot;table&quot;) %&gt;% 
  html_table(fill = TRUE) %&gt;%
  as.data.frame()

convert.brackets &lt;- function(x){
  if(grepl(&quot;\\(.*\\)&quot;, x)){
    paste0(&quot;-&quot;, gsub(&quot;\\(|\\)&quot;, &quot;&quot;, x))
  } else {
    x
  }
} # Function for convert parentheses to negative values

df_scm &lt;- df_scm[-c(1, 2, 3, 4),] %&gt;% # remove the fourth first lines
  rename(
    
    Week_Ending_Meal = &quot;X1&quot;,
    Weekly_Exports_Meal = &quot;X2&quot;,
    Accumulated_Exports_Meal = &quot;X3&quot;,
    Net_Sales_Meal = &quot;X4&quot;,
    Outstanding_Sales_Meal = &quot;X5&quot;,
    Net_Sales_Next_Market_Year_Meal = &quot;X6&quot;,
    Outstanding_Sales_Next_Market_Year_Meal = &quot;X7&quot;
    
  ) %&gt;%
   mutate( # all thongs inside mutate function is = data wrangling/manipulation
    
    day   = stringr::str_sub(Week_Ending_Meal, start = 4, end = 5), # Counting characters where begins and ends of
    day   = format(day, format = &quot;%d&quot;),
    
    month = stringr::str_extract(Week_Ending_Meal, &quot;^.{2}&quot;), # Extract the first 2 characters
    month = format(month, format = &quot;%m&quot;),
    Month_number = as.numeric(month),
    Month = month.name[Month_number],
    Month_Meal = Month,
    
    year  = stringr::str_sub(Week_Ending_Meal, start = 7, end = 10),
    year  = format(year, format = &quot;%y&quot;),
    Year_Meal  = as.numeric(year),
    
    Week_Ending_Meal = paste( year, &quot;-&quot; , month, &quot;-&quot; , day ),
    Week_Ending_Meal = gsub(&quot; &quot;, &quot;&quot;, Week_Ending_Meal ),
    Week_Ending_Meal = as_date(Week_Ending_Meal, &quot;%Y-%m-%d&quot;),
    
    YearMonth = yearmonth( Week_Ending_Meal),
    
    Weekly_Exports_Meal = gsub(&quot;,&quot;, &quot;&quot;, Weekly_Exports_Meal ),
    Weekly_Exports_Meal = as.numeric(Weekly_Exports_Meal),
    
    Accumulated_Exports_Meal = gsub(&quot;,&quot;, &quot;&quot;, Accumulated_Exports_Meal ),
    Accumulated_Exports_Meal = as.numeric(Accumulated_Exports_Meal),
    
    Net_Sales_Meal = sapply(Net_Sales_Meal, convert.brackets, USE.NAMES = F),
    Net_Sales_Meal = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Meal ),
    Net_Sales_Meal = as.numeric(Net_Sales_Meal),
    
    Outstanding_Sales_Meal = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Meal ),
    Outstanding_Sales_Meal = as.numeric(Outstanding_Sales_Meal),
    
    Net_Sales_Next_Market_Year_Meal = sapply(Net_Sales_Next_Market_Year_Meal, convert.brackets, USE.NAMES = F),
    Net_Sales_Next_Market_Year_Meal = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Next_Market_Year_Meal ),
    Net_Sales_Next_Market_Year_Meal = as.numeric(Net_Sales_Next_Market_Year_Meal),
    
    Outstanding_Sales_Next_Market_Year_Meal = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Next_Market_Year_Meal ),
    Outstanding_Sales_Next_Market_Year_Meal = as.numeric(Outstanding_Sales_Next_Market_Year_Meal),
    
    Month_Number = case_when(
      
      Month == &quot;January&quot; ~ 5,
      Month == &quot;February&quot; ~ 6,
      Month == &quot;March&quot; ~ 7,
      Month == &quot;April&quot; ~ 8,
      Month == &quot;May&quot; ~ 9,
      Month == &quot;June&quot;   ~ 10,
      Month == &quot;July&quot; ~ 11,
      Month == &quot;August&quot; ~   12,
      Month == &quot;September&quot; ~ 1,
      Month == &quot;October&quot; ~ 2,
      Month == &quot;November&quot; ~ 3,
      Month == &quot;December&quot;   ~ 4
    ),
    
    Accumulated_Sales_Meal = Accumulated_Exports_Meal + Outstanding_Sales_Meal,
    
  )

df_scm &lt;- df_scm %&gt;%
  mutate(
    Year_Exp = case_when(
      
      Month_Number ==  5 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  6 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  7 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  8 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  9 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == 10 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 11 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 12 &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Meal == &quot;September&quot; ~ paste(as.numeric(Year_Meal),&quot;/&quot;,as.numeric(Year_Meal) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;%
  mutate(
    Year_Exp = gsub(&quot; &quot;, &quot;&quot;, Year_Exp)
  )

df_scm &lt;- df_scm %&gt;%
  select(
    Week_Ending_Meal,
    Month_number,
    Month,
    Year_Exp,
    Weekly_Exports_Meal,
    Accumulated_Exports_Meal,
    Net_Sales_Meal,
    Outstanding_Sales_Meal,
    Net_Sales_Next_Market_Year_Meal,
    Year_Meal,
    Outstanding_Sales_Next_Market_Year_Meal,
    Accumulated_Sales_Meal
    
  )

df_scm &lt;- df_scm[-nrow(df_scm),] #remove the last row (NA)  

Meal &lt;- df_scm

# Select the columns to be monthly

Meal_M &lt;- Meal %&gt;%
  rename(
    Accumulated_Exp_Meal = &quot;Accumulated_Exports_Meal&quot;,
    Month_Meal = &quot;Month&quot;
  ) %&gt;%
  
  select(
    Week_Ending_Meal,
    Month_Meal,
    Year_Meal,
    Accumulated_Exp_Meal,
    Accumulated_Sales_Meal
  ) %&gt;%
  mutate(
    Month_Number = case_when(
      
                      Month_Meal == &quot;January&quot; ~ 5,
                      Month_Meal == &quot;February&quot; ~    6,
                      Month_Meal == &quot;March&quot; ~ 7,
                      Month_Meal == &quot;April&quot; ~ 8,
                      Month_Meal == &quot;May&quot; ~ 9,
                      Month_Meal == &quot;June&quot;  ~ 10,
                      Month_Meal == &quot;July&quot; ~    11,
                      Month_Meal == &quot;August&quot; ~  12,
                      Month_Meal == &quot;September&quot; ~ 1,
                      Month_Meal == &quot;October&quot; ~ 2,
                      Month_Meal == &quot;November&quot; ~    3,
                      Month_Meal == &quot;December&quot;  ~ 4  )
  ) %&gt;% 
  
  select(
    Week_Ending_Meal,
    Accumulated_Exp_Meal,
    Accumulated_Sales_Meal,
    Month_Meal,
    Year_Meal,
    #Year_Exp,
    Month_Number
  )

# Converting the dataset for use the last values of each month

Meal_M_xts &lt;- xts(Meal_M[,-1], order.by = Meal_M[,1]) 

dataset_monthly &lt;- aggregate(Meal_M_xts, as.Date(as.yearmon(time(Meal_M_xts))), last) %&gt;% # Using the last value in each month
  as.data.frame()
# datatable(dataset_monthly)

Meal_M &lt;- dataset_monthly %&gt;%
  mutate( # including again the Year_Exp
    
    Year_Exp = case_when(
      
      Month_Number == &quot; 5&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 6&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 7&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 8&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 9&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == &quot;10&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;11&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;12&quot; &amp; Year_Meal == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Meal == &quot;September&quot; ~ paste(as.numeric(Year_Meal),&quot;/&quot;,as.numeric(Year_Meal) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;% 
  mutate(
    Year_Exp = gsub(&quot; &quot;,&quot;&quot;, Year_Exp)
  )


Meal_M &lt;- data.frame(
  
  Meal_M$Accumulated_Exp_Meal,
  Meal_M$Accumulated_Sales_Meal,
  Meal_M$Month_Meal,
  Meal_M$Year_Meal,
  Meal_M$Year_Exp,
  Meal_M$Month_Number
) %&gt;%
  rename(
    Accumulated_Exp_Meal = &quot;Meal_M.Accumulated_Exp_Meal&quot;,
    Accumulated_Sales_Meal = &quot;Meal_M.Accumulated_Sales_Meal&quot;,
    Month_Meal = &quot;Meal_M.Month_Meal&quot;,
    Year_Meal = &quot;Meal_M.Year_Meal&quot;,
    Year_Exp = &quot;Meal_M.Year_Exp&quot;,
    Month_Number = &quot;Meal_M.Month_Number&quot;
  ) %&gt;%
  mutate(
    
    Accumulated_Exp_Meal = as.numeric(Accumulated_Exp_Meal),
    Accumulated_Sales_Meal = as.numeric(Accumulated_Sales_Meal),
    Year_Meal = as.numeric(Year_Meal),
    Month_Number = as.numeric(Month_Number)
    
  )

url_oil &lt;-  &quot;https://apps.fas.usda.gov/export-sales/h902.htm&quot;

df_oil &lt;- url_oil %&gt;% 
  read_html() %&gt;% 
  html_nodes(&quot;table&quot;) %&gt;% 
  html_table(fill = TRUE) %&gt;%
  as.data.frame()

convert.brackets &lt;- function(x){
  if(grepl(&quot;\\(.*\\)&quot;, x)){
    paste0(&quot;-&quot;, gsub(&quot;\\(|\\)&quot;, &quot;&quot;, x))
  } else {
    x
  }
} # Function for convert parentheses to negative values

df_oil &lt;- df_oil[-c(1, 2, 3, 4),] %&gt;% # remove the fourth first lines
  rename(
    
    Week_Ending_Oil = &quot;X1&quot;,
    Weekly_Exports_Oil = &quot;X2&quot;,
    Accumulated_Exports_Oil = &quot;X3&quot;,
    Net_Sales_Oil = &quot;X4&quot;,
    Outstanding_Sales_Oil = &quot;X5&quot;,
    Net_Sales_Next_Market_Year_Oil = &quot;X6&quot;,
    Outstanding_Sales_Next_Market_Year_Oil = &quot;X7&quot;
    
  ) %&gt;%
  mutate( # all thongs inside mutate function is = data wrangling/manipulation
    
    day   = stringr::str_sub(Week_Ending_Oil, start = 4, end = 5), # Counting characters where begins and ends of
    day   = format(day, format = &quot;%d&quot;),
    
    month = stringr::str_extract(Week_Ending_Oil, &quot;^.{2}&quot;), # Extract the first 2 characters
    month = format(month, format = &quot;%m&quot;),
    Month_number = as.numeric(month),
    Month = month.name[Month_number],
    Month_Oil = Month,
    
    year  = stringr::str_sub(Week_Ending_Oil, start = 7, end = 10),
    year  = format(year, format = &quot;%y&quot;),
    Year_Oil  = as.numeric(year),
    
    Week_Ending_Oil = paste( year, &quot;-&quot; , month, &quot;-&quot; , day ),
    Week_Ending_Oil = gsub(&quot; &quot;, &quot;&quot;, Week_Ending_Oil ),
    Week_Ending_Oil = as_date(Week_Ending_Oil, &quot;%Y-%m-%d&quot;),
    
    YearMonth = yearmonth( Week_Ending_Oil),
    
    Weekly_Exports_Oil = gsub(&quot;,&quot;, &quot;&quot;, Weekly_Exports_Oil ),
    Weekly_Exports_Oil = as.numeric(Weekly_Exports_Oil),
    
    Accumulated_Exports_Oil = gsub(&quot;,&quot;, &quot;&quot;, Accumulated_Exports_Oil ),
    Accumulated_Exports_Oil = as.numeric(Accumulated_Exports_Oil),
    
    Net_Sales_Oil = sapply(Net_Sales_Oil, convert.brackets, USE.NAMES = F),
    Net_Sales_Oil = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Oil ),
    Net_Sales_Oil = as.numeric(Net_Sales_Oil),
    
    Outstanding_Sales_Oil = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Oil ),
    Outstanding_Sales_Oil = as.numeric(Outstanding_Sales_Oil),
    
    Net_Sales_Next_Market_Year_Oil = sapply(Net_Sales_Next_Market_Year_Oil, convert.brackets, USE.NAMES = F),
    Net_Sales_Next_Market_Year_Oil = gsub(&quot;,&quot;, &quot;&quot;, Net_Sales_Next_Market_Year_Oil ),
    Net_Sales_Next_Market_Year_Oil = as.numeric(Net_Sales_Next_Market_Year_Oil),
    
    Outstanding_Sales_Next_Market_Year_Oil = gsub(&quot;,&quot;, &quot;&quot;, Outstanding_Sales_Next_Market_Year_Oil ),
    Outstanding_Sales_Next_Market_Year_Oil = as.numeric(Outstanding_Sales_Next_Market_Year_Oil),
    
    Month_Number = case_when(
      
      Month == &quot;January&quot; ~ 5,
      Month == &quot;February&quot; ~ 6,
      Month == &quot;March&quot; ~ 7,
      Month == &quot;April&quot; ~ 8,
      Month == &quot;May&quot; ~ 9,
      Month == &quot;June&quot;   ~ 10,
      Month == &quot;July&quot; ~ 11,
      Month == &quot;August&quot; ~   12,
      Month == &quot;September&quot; ~ 1,
      Month == &quot;October&quot; ~ 2,
      Month == &quot;November&quot; ~ 3,
      Month == &quot;December&quot;   ~ 4
    ),
    
    Accumulated_Sales_Oil = Accumulated_Exports_Oil + Outstanding_Sales_Oil,
    
  )

df_oil &lt;- df_oil %&gt;%
  mutate(
    Year_Exp = case_when(
      
      Month_Number ==  5 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  6 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  7 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  8 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number ==  9 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == 10 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 11 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == 12 &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Oil == &quot;September&quot; ~ paste(as.numeric(Year_Oil),&quot;/&quot;,as.numeric(Year_Oil) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;%
  mutate(
    Year_Exp = gsub(&quot; &quot;, &quot;&quot;, Year_Exp)
  )

df_oil &lt;- df_oil %&gt;%
  select(
    Week_Ending_Oil,
    Month_number,
    Month,
    Year_Exp,
    Weekly_Exports_Oil,
    Accumulated_Exports_Oil,
    Net_Sales_Oil,
    Outstanding_Sales_Oil,
    Net_Sales_Next_Market_Year_Oil,
    Year_Oil,
    Outstanding_Sales_Next_Market_Year_Oil,
    Accumulated_Sales_Oil
    
  )

df_oil &lt;- df_oil[-nrow(df_oil),] #remove the last row (NA)  

Soybean_Oil &lt;- df_oil

# Select the columns to be monthly

Oil_M &lt;- Soybean_Oil %&gt;%
  rename(
    Accumulated_Exp_Oil = &quot;Accumulated_Exports_Oil&quot;,
    Month_Oil = &quot;Month&quot;
  ) %&gt;%
  
  select(
    Week_Ending_Oil,
    Month_Oil,
    Year_Oil,
    Accumulated_Exp_Oil,
    Accumulated_Sales_Oil
  ) %&gt;%
  mutate(
    Month_Number = case_when(
      
                      Month_Oil == &quot;January&quot;      ~ 5,
                      Month_Oil == &quot;February&quot;     ~ 6,
                      Month_Oil == &quot;March&quot;        ~ 7,
                      Month_Oil == &quot;April&quot;        ~ 8,
                      Month_Oil == &quot;May&quot;          ~ 9,
                      Month_Oil == &quot;June&quot;         ~ 10,
                      Month_Oil == &quot;July&quot;         ~ 11,
                      Month_Oil == &quot;August&quot;       ~ 12,
                      Month_Oil == &quot;September&quot;    ~ 1,
                      Month_Oil == &quot;October&quot;      ~ 2,
                      Month_Oil == &quot;November&quot;     ~ 3,
                      Month_Oil == &quot;December&quot;     ~ 4  )
  ) %&gt;% 
  
  select(
    Week_Ending_Oil,
    Accumulated_Exp_Oil,
    Accumulated_Sales_Oil,
    Month_Oil,
    Year_Oil,
    #Year_Exp,
    Month_Number
  )

# Converting the dataset for use the last values of each month

Oil_M_xts &lt;- xts(Oil_M[,-1], order.by = Oil_M[,1]) 

dataset_monthly &lt;- aggregate(Oil_M_xts, as.Date(as.yearmon(time(Oil_M_xts))), last) %&gt;% # Using the last value in each month
  as.data.frame()
# datatable(dataset_monthly)

Oil_M &lt;- dataset_monthly %&gt;%
  mutate( # including again the Year_Exp
    
    Year_Exp = case_when(
      
      Month_Number == &quot; 5&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 6&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 7&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 8&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      Month_Number == &quot; 9&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,  
      Month_Number == &quot;10&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;11&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;, 
      Month_Number == &quot;12&quot; &amp; Year_Oil == &quot;1990&quot; ~ &quot;1989 / 1990&quot;,
      
      Month_Oil == &quot;September&quot; ~ paste(as.numeric(Year_Oil),&quot;/&quot;,as.numeric(Year_Oil) + 1) )
  ) %&gt;% fill(Year_Exp, .direction =&quot;down&quot;) %&gt;% 
  mutate(
    Year_Exp = gsub(&quot; &quot;,&quot;&quot;, Year_Exp)
  )


Oil_M &lt;- data.frame(
  
  Oil_M$Accumulated_Exp_Oil,
  Oil_M$Accumulated_Sales_Oil,
  Oil_M$Month_Oil,
  Oil_M$Year_Oil,
  Oil_M$Year_Exp,
  Oil_M$Month_Number
) %&gt;%
  rename(
    Accumulated_Exp_Oil = &quot;Oil_M.Accumulated_Exp_Oil&quot;,
    Accumulated_Sales_Oil = &quot;Oil_M.Accumulated_Sales_Oil&quot;,
    Month_Oil = &quot;Oil_M.Month_Oil&quot;,
    Year_Oil = &quot;Oil_M.Year_Oil&quot;,
    Year_Exp = &quot;Oil_M.Year_Exp&quot;,
    Month_Number = &quot;Oil_M.Month_Number&quot;
  ) %&gt;%
  mutate(
    
    Accumulated_Exp_Oil = as.numeric(Accumulated_Exp_Oil),
    Accumulated_Sales_Oil = as.numeric(Accumulated_Sales_Oil),
    Year_Oil = as.numeric(Year_Oil),
    Month_Number = as.numeric(Month_Number)
    
  )</code></pre>
<div id="abra-o-seu-power-bi-desktop" class="section level2">
<h2>Abra o seu Power BI Desktop</h2>
<p>Agora sim, no seu Power BI Desktop vá em Obter Dados em seguida escolha Script do R e cole todo o conteúdo dos códigos acima feitos e dê um Enter!</p>
<p> </p>
<p><img src="https://github.com/rhozon/datasets/raw/master/etlpowrbia.png" /></p>
<p> </p>
<p>Cole o conteúdo do chunk acima…</p>
<p> </p>
<p><img src="https://github.com/rhozon/datasets/raw/master/etlpowerbib.png" /></p>
<p> </p>
<p>Clique em Ok e aguarde um pouquinho pq isso é um pouco lento…Uma dica útil, caso prefira, você pode copiar e colar até o final a partir da segunda url no código acima e fazer essa extração em duas etapas.</p>
<p><img src="https://github.com/rhozon/datasets/raw/master/etlpowerbic.png" /></p>
<p>Um pouquinho de sua paciência…Em seguida aparecerá essa opção:</p>
<p> </p>
<p><img src="https://github.com/rhozon/datasets/raw/master/etl_power_bi1.png" />  </p>
<p>Selecione <code>Corn_M</code>, <code>Soybeans_M</code> e todos os outros em que os nomes terminam com <code>_M</code>. Em seguida, clique em Carregar.</p>
<p>Agora navegue no Power Query e veja as tabelas que foram geradas no Power BI:</p>
<p> </p>
<p><img src="https://github.com/rhozon/datasets/raw/master/etl_powerbi2.png" /></p>
<p> </p>
<p>E finalmente você é livre pra montar a visualização que você desejar…eu fiz dois gráficos simples aqui:</p>
<p> </p>
<p><img src="https://github.com/rhozon/datasets/raw/master/etl_powerbi3.png" /></p>
</div>
</div>
<div id="publicando-e-setando-atualizações-automáticas" class="section level1">
<h1>Publicando e setando atualizações automáticas</h1>
<p>Mais do que simplesmente fazermos a rotina do ETL no R e vincularmos ao Power BI, é fundamental que sejamos capazes de automatizar isso com o próprio auxílio das ferramentas da Microsoft.</p>
<p>Então clique em Publicar Relatório, escolha um Workspace e agora siga esses passos para setar as atualizações agendadas.</p>
<ol style="list-style-type: decimal">
<li>Vá em seu Power Query clique no nome de alguma tabela e selecione a opção Editar Consultas</li>
</ol>
<p> </p>
<p><img src="https://github.com/rhozon/datasets/raw/master/etl_power_bi4.png" />  </p>
<ol start="2" style="list-style-type: decimal">
<li>Clique em Configurações da fonte de dados &gt; Editar Permissões e Credenciais Windows, Nível de Privacidade em Organizacional e em seguida Consultas ao Banco de Dados Nativo clique em revogar. Faça esse procedimento para as quatro tabelas que subimos e temos no Power Query.</li>
</ol>
<p> </p>
<p><img src="https://github.com/rhozon/datasets/raw/master/power_bi5.png" />  </p>
<p>Se alguma delas aparecer ao lado com a exclamação ! clique nela e selecione a opção Editar Permissão:</p>
<p> </p>
<p><img src="https://github.com/rhozon/datasets/raw/master/etl_powerbi6.png" /></p>
<p> </p>
<p><img src="https://github.com/rhozon/datasets/raw/master/etl_power_bi7.png" /></p>
<p> </p>
<p>Clique em executar e em seguida vá em Fechar e Aplicar.</p>
<ol start="3" style="list-style-type: decimal">
<li>No seu Workspace vá em Configurações do Conjunto de Dados e em seguida verifique se a opção de atualização agendada está disponível para você habilitar. Se não estiver será necessário que você baixe e instale o On Promisses Data Gateway que aparece ali como recomendado.</li>
</ol>
<p><img src="https://github.com/rhozon/datasets/raw/master/etl_powerbi7.png" /></p>
<ol start="4" style="list-style-type: decimal">
<li><p>Ele já configura automaticamente a conexão com o extrator de banco de dados. Caso você já tenha ele instalado em sua máquina local clique em Entrar e logue com seu endereço de e-mail corporativo.</p></li>
<li><p>Confirme se as opções da conexão do gateway e das credenciais das fontes de dados como na imagem abaixo:</p></li>
</ol>
<p> </p>
<p><img src="https://github.com/rhozon/datasets/raw/master/etl_powerbi8.png" /></p>
<p> </p>
<ol start="6" style="list-style-type: decimal">
<li>Não se esqueça de setar as programações de atualizações automáticas necessárias para o seu caso. No nosso exemplo, utilizaremos uma atualização semanal toda sexta-feira.</li>
</ol>
<p> </p>
<p><img src="https://github.com/rhozon/datasets/raw/master/etl_powerbi9.png" /></p>
<p> </p>
<p>Prontinho! Agora temos um BI com dados que são atualizados automaticamente uma vez por semana, sem necessidade de se criar qualquer planilha adicional a ser alimentada, sem a necessidade de entrar no site periodicamente copiar as linhas de dados novos e colar nessa mesma planilha e atualizar o BI sempre que sai um dado novo!</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
</div>
<div id="referências" class="section level1">
<h1>Referências</h1>
<p>USDA, <a href="https://apps.fas.usda.gov/export-sales/">U.S. Export Sales</a></p>
<hr />
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<hr />
<p>Contador do tempo total de execução.</p>
<pre class="r"><code>end_time &lt;- Sys.time()

end_time - start_time</code></pre>
<pre><code>Time difference of 15.24117 secs</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
